<!DOCTYPE html>
<!-- saved from url=(0046)file:///C:/Users/Owner/Downloads/index_25.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBS Court Scope Builder</title>
<link href="./index_files/css2" rel="stylesheet">
<style>
  :root {
    --blue: #1a6dcc;
    --blue-dark: #0f4a91;
    --blue-light: #e8f1fb;
    --gray: #4a5568;
    --gray-light: #f4f6f9;
    --border: #d1dbe8;
    --text: #1a202c;
    --accent: #f0a500;
    --danger: #e53e3e;
    --success: #38a169;
    --white: #ffffff;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Barlow', sans-serif;
    background: #0d1f3c;
    min-height: 100vh;
    color: var(--text);
  }

  /* HEADER */
  .app-header {
    background: linear-gradient(135deg, #0a1628 0%, #0d2147 60%, #0f3070 100%);
    padding: 18px 32px;
    display: flex;
    align-items: center;
    gap: 18px;
    border-bottom: 3px solid var(--accent);
  }

  .logo-text {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 1.5rem;
    color: var(--white);
    line-height: 1.1;
  }
  .logo-text span { color: var(--accent); }
  .logo-sub {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    color: #94b3d8;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-top: 2px;
  }

  .header-title {
    margin-left: auto;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.3rem;
    font-weight: 700;
    color: #94b3d8;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  /* MAIN LAYOUT */
  .app-body {
    max-width: 860px;
    margin: 0 auto;
    padding: 32px 20px 60px;
  }

  /* PROGRESS BAR */
  .progress-wrap {
    background: rgba(255,255,255,0.07);
    border-radius: 12px;
    padding: 18px 24px;
    margin-bottom: 28px;
  }
  .progress-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #94b3d8;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
  }
  .progress-bar-bg {
    background: rgba(255,255,255,0.1);
    border-radius: 99px;
    height: 6px;
    overflow: hidden;
  }
  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--blue), var(--accent));
    border-radius: 99px;
    transition: width 0.4s ease;
  }
  .step-dots {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    flex-wrap: wrap;
  }
  .step-dot {
    height: 6px;
    flex: 1;
    border-radius: 99px;
    background: rgba(255,255,255,0.1);
    transition: background 0.3s;
    min-width: 20px;
  }
  .step-dot.done { background: var(--blue); }
  .step-dot.active { background: var(--accent); }

  /* CARD */
  .card {
    background: var(--white);
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    animation: slideUp 0.35s ease;
  }
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .section-tag {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--blue);
    background: var(--blue-light);
    display: inline-block;
    padding: 3px 10px;
    border-radius: 4px;
    margin-bottom: 10px;
  }

  .card h2 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.6rem;
    font-weight: 800;
    color: var(--text);
    margin-bottom: 6px;
  }

  .card-desc {
    color: var(--gray);
    font-size: 0.9rem;
    margin-bottom: 26px;
    line-height: 1.6;
  }

  /* FORM ELEMENTS */
  .field-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }
  .field-grid.single { grid-template-columns: 1fr; }
  .field-grid.triple { grid-template-columns: 1fr 1fr 1fr; }

  .field {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .field.full { grid-column: 1 / -1; }

  label {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--gray);
    letter-spacing: 0.03em;
    text-transform: uppercase;
  }

  input[type="text"], input[type="number"], input[type="date"], select, textarea {
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 0.95rem;
    font-family: 'Barlow', sans-serif;
    color: var(--text);
    background: var(--white);
    transition: border-color 0.2s, box-shadow 0.2s;
    width: 100%;
  }
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--blue);
    box-shadow: 0 0 0 3px rgba(26,109,204,0.12);
  }
  textarea { resize: vertical; min-height: 70px; }

  /* OPTION CARDS (court type etc) */
  .option-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin-bottom: 4px;
  }

  .option-card {
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 14px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--gray-light);
  }
  .option-card:hover { border-color: var(--blue); background: var(--blue-light); }
  .option-card.selected { border-color: var(--blue); background: var(--blue-light); }
  .option-card.selected .opt-icon { color: var(--blue); }
  .option-card.selected .opt-label { color: var(--blue-dark); font-weight: 700; }
  .option-card input[type="radio"], .option-card input[type="checkbox"] { display: none; }
  .opt-icon { font-size: 1.8rem; display: block; margin-bottom: 6px; }
  .opt-label { font-size: 0.85rem; font-weight: 600; color: var(--gray); }

  /* CHECKBOX LIST */
  .check-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .check-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
    background: var(--gray-light);
  }
  .check-item:hover { border-color: var(--blue); background: var(--blue-light); }
  .check-item input[type="checkbox"] { accent-color: var(--blue); width: 16px; height: 16px; }
  .check-item-label { font-size: 0.9rem; color: var(--text); }

  /* DIVIDER */
  .divider {
    border: none;
    border-top: 1.5px solid var(--border);
    margin: 24px 0;
  }

  .sub-heading {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    color: var(--blue-dark);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 14px;
    margin-top: 4px;
  }

  /* BUTTONS */
  .btn-row {
    display: flex;
    gap: 12px;
    margin-top: 30px;
    justify-content: flex-end;
  }

  .btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1rem;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 12px 28px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-primary {
    background: var(--blue);
    color: var(--white);
  }
  .btn-primary:hover { background: var(--blue-dark); transform: translateY(-1px); }
  .btn-secondary {
    background: var(--gray-light);
    color: var(--gray);
    border: 1.5px solid var(--border);
  }
  .btn-secondary:hover { background: var(--border); }
  .btn-accent {
    background: var(--accent);
    color: #1a1a1a;
  }
  .btn-accent:hover { background: #d98e00; transform: translateY(-1px); }

  /* INLINE TOGGLE (for yes/no etc) */
  .toggle-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .toggle-btn {
    padding: 8px 18px;
    border-radius: 6px;
    border: 1.5px solid var(--border);
    background: var(--gray-light);
    font-size: 0.88rem;
    font-weight: 600;
    cursor: pointer;
    color: var(--gray);
    transition: all 0.15s;
  }
  .toggle-btn:hover { border-color: var(--blue); color: var(--blue); }
  .toggle-btn.active { background: var(--blue); border-color: var(--blue); color: var(--white); }

  /* REPORT */
  .report-wrap {
    background: var(--white);
    border-radius: 16px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    overflow: hidden;
    animation: slideUp 0.35s ease;
  }

  .report-header {
    background: linear-gradient(135deg, #0a1628 0%, #0d2147 100%);
    padding: 28px 36px;
    border-bottom: 4px solid var(--accent);
  }
  .report-header h1 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 1.8rem;
    color: var(--white);
    margin-bottom: 4px;
  }
  .report-header .report-meta {
    color: #94b3d8;
    font-size: 0.88rem;
  }

  .report-body { padding: 32px 36px; }

  .report-section {
    margin-bottom: 28px;
  }
  .report-section-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--blue);
    background: var(--blue-light);
    padding: 4px 10px;
    border-radius: 4px;
    display: inline-block;
    margin-bottom: 14px;
  }
  .report-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 24px;
  }
  .report-field {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  .report-field.full { grid-column: 1/-1; }
  .report-field-label {
    font-size: 0.72rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #94a3b8;
  }
  .report-field-value {
    font-size: 0.95rem;
    color: var(--text);
    font-weight: 500;
  }
  .report-field-value.empty { color: #cbd5e0; font-style: italic; }

  .scope-list {
    list-style: none;
    padding: 0;
  }
  .scope-list li {
    padding: 6px 0;
    border-bottom: 1px solid #f0f4f8;
    font-size: 0.92rem;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text);
  }
  .scope-list li::before {
    content: '‚úì';
    color: var(--success);
    font-weight: 700;
    font-size: 0.85rem;
    flex-shrink: 0;
  }

  .report-divider {
    border: none;
    border-top: 1.5px solid #e2e8f0;
    margin: 20px 0;
  }

  .report-footer {
    background: var(--gray-light);
    padding: 18px 36px;
    border-top: 1.5px solid var(--border);
    display: flex;
    gap: 14px;
    justify-content: flex-end;
    flex-wrap: wrap;
  }

  .warn-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: #fff8e1;
    border: 1px solid #f0c040;
    color: #7d5a00;
    border-radius: 6px;
    padding: 4px 10px;
    font-size: 0.82rem;
    font-weight: 600;
    margin-top: 4px;
  }

  @media (max-width: 600px) {
    .field-grid { grid-template-columns: 1fr; }
    .report-grid { grid-template-columns: 1fr; }
    .app-header { flex-wrap: wrap; }
    .header-title { margin-left: 0; }
    .card { padding: 20px; }
    .report-body { padding: 20px; }
  }

  /* MATERIAL EDITOR */
  .btn-modify-mat {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700; font-size: 0.82rem; letter-spacing: 0.06em;
    text-transform: uppercase; padding: 7px 16px; border-radius: 6px;
    border: 1.5px solid var(--blue); background: transparent;
    color: var(--blue); cursor: pointer; transition: all 0.15s;
  }
  .btn-modify-mat:hover { background: var(--blue); color: white; }
  .mat-editor { border: 1.5px solid var(--border); border-radius: 10px; overflow: hidden; margin-top: 12px; font-size: 0.85rem; }
  .mat-row { display: flex; align-items: center; gap: 6px; padding: 5px 8px; border-bottom: 1px solid #f0f4f8; }
  .mat-row:last-child { border-bottom: none; }
  .mat-header { background: #f0f4f8; font-family: 'Barlow Condensed', sans-serif; font-size: 0.72rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--gray); padding: 7px 8px; }
  .mat-add-row { background: #f8fafc; }
  .mc { flex-shrink: 0; }
  .mc-name  { flex: 2; min-width: 120px; }
  .mc-num   { flex: 0.8; text-align: center; min-width: 72px; }
  .mc-scale { flex: 0.6; text-align: center; min-width: 60px; }
  .mc-total { flex: 0.8; text-align: right; min-width: 72px; font-weight: 600; color: var(--text); }
  .mc-del   { flex: 0; min-width: 54px; text-align: center; }
  .mat-input { border: 1px solid var(--border); border-radius: 5px; padding: 4px 6px; font-size: 0.85rem; font-family: 'Barlow', sans-serif; color: var(--text); background: white; width: 100%; }
  .mat-input:focus { outline: none; border-color: var(--blue); }
  .mat-scale-btn { font-size: 0.75rem; font-weight: 600; padding: 3px 8px; border-radius: 4px; border: 1px solid var(--border); background: var(--gray-light); color: var(--gray); cursor: pointer; white-space: nowrap; width: 100%; transition: all 0.15s; }
  .mat-scale-btn.active { background: var(--blue); border-color: var(--blue); color: white; }
  .mat-del-btn { background: none; border: none; color: #e53e3e; cursor: pointer; font-size: 0.8rem; padding: 2px 4px; border-radius: 3px; line-height: 1; }
  .mat-del-btn:hover { background: #fff0f0; }
  .mat-add-btn { background: var(--blue); color: white; border: none; border-radius: 5px; padding: 4px 10px; font-size: 0.82rem; font-weight: 700; cursor: pointer; white-space: nowrap; }
  .mat-add-btn:hover { background: var(--blue-dark); }
  .mat-editor-footer { display: flex; align-items: center; gap: 14px; padding: 8px 10px; background: #f8fafc; border-top: 1px solid var(--border); flex-wrap: wrap; }
  .mat-reset-btn { font-size: 0.8rem; font-weight: 700; padding: 5px 12px; border-radius: 5px; border: 1px solid var(--border); background: white; color: var(--gray); cursor: pointer; white-space: nowrap; }
  .mat-reset-btn:hover { border-color: var(--danger); color: var(--danger); }
  .mat-footer-note { font-size: 0.78rem; color: #94a3b8; font-style: italic; }

  /* HIDDEN */
  .hidden { display: none !important; }
  @media print {
  .report-body > div[style*="grid"] { display:grid !important; break-inside:avoid; }
    * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
    body { background: #fff !important; margin: 0; padding: 0; }
    .app-header, .progress-wrap, #stepsContainer, .report-footer { display: none !important; }
    .app-body { max-width: 100%; padding: 0; margin: 0; }
    #reportContainer { display: block !important; }
    .report-wrap { box-shadow: none !important; border-radius: 0 !important; }
    .report-header {
      background: #0a1628 !important;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
      padding: 20px 28px !important;
    }
    .report-header h1 { color: #ffffff !important; font-size: 1.4rem !important; }
    .report-header .report-meta { color: #94b3d8 !important; }
    .report-section-title { background: #e8f1fb !important; color: #1a6dcc !important; }
    .report-body { padding: 20px 28px !important; }
    .report-section { page-break-inside: avoid; margin-bottom: 18px; }
    .scope-list li::before { color: #38a169 !important; }
    .warn-badge { background: #fff8e1 !important; border-color: #f0c040 !important; color: #7d5a00 !important; }
  }

  /* PRODUCT CARDS */
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 16px;
    margin-bottom: 8px;
  }
  .product-card {
    border: 2px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--white);
    position: relative;
  }
  .product-card:hover { border-color: var(--blue); box-shadow: 0 4px 16px rgba(26,109,204,0.12); }
  .product-card.selected { border-color: var(--blue); box-shadow: 0 4px 16px rgba(26,109,204,0.2); }
  .product-card.selected::after {
    content: '‚úì';
    position: absolute;
    top: 8px; right: 8px;
    background: var(--blue);
    color: white;
    width: 22px; height: 22px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
  }
  .product-img {
    width: 100%;
    height: 160px;
    object-fit: cover;
    background: #f0f4f8;
    display: block;
  }
  .product-img-placeholder {
    width: 100%;
    height: 160px;
    background: linear-gradient(135deg, #e8f1fb, #f4f6f9);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
  }
  .product-info {
    padding: 12px;
  }
  .product-name {
    font-weight: 700;
    font-size: 0.88rem;
    color: var(--text);
    margin-bottom: 4px;
    line-height: 1.3;
  }
  .product-desc {
    font-size: 0.78rem;
    color: var(--gray);
    line-height: 1.4;
    margin-bottom: 8px;
  }
  .product-price {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 1.1rem;
    color: var(--blue-dark);
  }
  .product-shipping {
    font-size: 0.72rem;
    color: var(--gray);
    margin-top: 2px;
  }
  .qty-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
  }
  .qty-btn {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 1.5px solid var(--border);
    background: var(--gray-light);
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
    color: var(--text);
  }
  .qty-btn:hover { border-color: var(--blue); color: var(--blue); }
  .qty-display {
    font-weight: 700;
    font-size: 0.95rem;
    min-width: 20px;
    text-align: center;
  }

  /* PRICE SUMMARY BAR */
  .price-bar {
    background: linear-gradient(135deg, #0a1628, #0d2147);
    border-radius: 10px;
    padding: 16px 20px;
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
  }
  .price-bar-label {
    color: #94b3d8;
    font-size: 0.82rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  .price-bar-amount {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 1.4rem;
    color: var(--accent);
  }
  .price-breakdown {
    font-size: 0.78rem;
    color: #94b3d8;
    margin-top: 2px;
  }

  /* REPORT ACCESSORY TABLE */
  .acc-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.88rem;
  }
  .acc-table th {
    text-align: left;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #94a3b8;
    padding: 6px 8px;
    border-bottom: 2px solid #e2e8f0;
  }
  .acc-table td {
    padding: 8px 8px;
    border-bottom: 1px solid #f0f4f8;
    color: var(--text);
    vertical-align: middle;
  }
  .acc-table tr:last-child td { border-bottom: none; }
  .acc-total-row td {
    font-weight: 700;
    border-top: 2px solid #e2e8f0;
    padding-top: 10px;
  }

  .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(210px, 1fr)); gap: 16px; margin-bottom: 8px; }
  .product-card { border: 2px solid var(--border); border-radius: 12px; overflow: hidden; cursor: pointer; transition: all 0.2s; background: var(--white); position: relative; }
  .product-card:hover { border-color: var(--blue); box-shadow: 0 4px 16px rgba(26,109,204,0.12); }
  .product-card.selected { border-color: var(--blue); box-shadow: 0 4px 16px rgba(26,109,204,0.2); }
  .product-card.selected .pc-check { display: flex !important; }
  .pc-check { display: none; position: absolute; top: 8px; right: 8px; background: var(--blue); color: white; width: 22px; height: 22px; border-radius: 50%; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; }
  .product-img { width: 100%; height: 150px; object-fit: cover; object-position: center 30%; background: #f0f4f8; display: block; }
  .product-info { padding: 11px; }
  .product-name { font-weight: 700; font-size: 0.85rem; color: var(--text); margin-bottom: 3px; line-height: 1.3; }
  .product-desc { font-size: 0.75rem; color: var(--gray); line-height: 1.4; margin-bottom: 7px; }
  .product-price { font-family: "Barlow Condensed", sans-serif; font-weight: 800; font-size: 1.1rem; color: var(--blue-dark); }
  .product-ship { font-size: 0.7rem; color: var(--gray); margin-top: 2px; }
  .qty-row { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
  .qty-btn { width: 26px; height: 26px; border-radius: 50%; border: 1.5px solid var(--border); background: var(--gray-light); font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text); transition: all 0.15s; }
  .qty-btn:hover { border-color: var(--blue); color: var(--blue); }
  .qty-num { font-weight: 700; font-size: 0.95rem; min-width: 18px; text-align: center; }
  .price-bar { background: linear-gradient(135deg, #0a1628, #0d2147); border-radius: 10px; padding: 14px 18px; margin-top: 18px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
  .price-bar-label { color: #94b3d8; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; }
  .price-bar-amount { font-family: "Barlow Condensed", sans-serif; font-weight: 800; font-size: 1.5rem; color: var(--accent); }
  .price-breakdown { font-size: 0.75rem; color: #94b3d8; margin-top: 2px; }
  .tax-toggle { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
  .tax-toggle-label { font-size: 0.8rem; color: #94b3d8; font-weight: 600; }
  .acc-table { width: 100%; border-collapse: collapse; font-size: 0.88rem; }
  .acc-table th { text-align: left; font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: #94a3b8; padding: 5px 8px; border-bottom: 2px solid #e2e8f0; }
  .acc-table td { padding: 7px 8px; border-bottom: 1px solid #f0f4f8; color: var(--text); }
  .acc-total-row td { font-weight: 700; border-top: 2px solid #e2e8f0; padding-top: 10px; }

  .paint-option-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap: 12px; margin-bottom: 20px; }
  .paint-option { border: 2px solid var(--border); border-radius: 10px; padding: 16px; cursor: pointer; transition: all 0.2s; background: var(--gray-light); }
  .paint-option:hover { border-color: var(--blue); background: var(--blue-light); }
  .paint-option.selected { border-color: var(--blue); background: var(--blue-light); }
  .paint-option-title { font-weight: 700; font-size: 0.95rem; color: var(--text); margin-bottom: 4px; }
  .paint-option-desc { font-size: 0.78rem; color: var(--gray); line-height: 1.4; }
  .estimate-box { background: linear-gradient(135deg, #0a1628, #0d2147); border-radius: 12px; padding: 20px 24px; margin-top: 20px; }
  .estimate-box-title { font-family: "Barlow Condensed", sans-serif; font-size: 0.72rem; font-weight: 700; letter-spacing: 0.14em; text-transform: uppercase; color: #94b3d8; margin-bottom: 14px; }
  .estimate-row { display: flex; justify-content: space-between; align-items: baseline; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.07); font-size: 0.88rem; }
  .estimate-row:last-child { border-bottom: none; }
  .estimate-row-label { color: #94b3d8; }
  .estimate-row-value { color: #fff; font-weight: 600; }
  .estimate-total { display: flex; justify-content: space-between; align-items: baseline; padding: 12px 0 0; margin-top: 8px; border-top: 2px solid rgba(255,255,255,0.15); }
  .estimate-total-label { color: #f0a500; font-family: "Barlow Condensed", sans-serif; font-weight: 700; font-size: 1rem; text-transform: uppercase; letter-spacing: 0.08em; }
  .estimate-total-value { color: #f0a500; font-family: "Barlow Condensed", sans-serif; font-weight: 800; font-size: 1.5rem; }
  .travel-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; margin-top: 8px; }
  .travel-badge.ok { background: rgba(56,161,105,0.15); color: #38a169; border: 1px solid rgba(56,161,105,0.3); }
  .travel-badge.pending { background: rgba(240,165,0,0.12); color: #d98e00; border: 1px solid rgba(240,165,0,0.3); }

</style>
</head>
<body>

<div class="app-header">
  <div>
    <div class="logo-text">MY BACKYARD <span>SPORTS</span></div>
    <div class="logo-sub">Design &amp; Install</div>
  </div>
  <div class="header-title">Court Scope Builder</div>
</div>

<div class="app-body">

  <!-- PROGRESS -->
  <div class="progress-wrap" id="progressWrap">
    <div class="progress-label">
      <span id="stepLabel">Step 1 of 7</span>
      <span id="stepCount">Project Setup</span>
    </div>
    <div class="progress-bar-bg">
      <div class="progress-bar-fill" id="progressFill" style="width:0%"></div>
    </div>
    <div class="step-dots" id="stepDots"><div class="step-dot active"></div><div class="step-dot "></div><div class="step-dot "></div><div class="step-dot "></div><div class="step-dot "></div><div class="step-dot "></div><div class="step-dot "></div></div>
  </div>

  <!-- STEPS CONTAINER -->
  <div id="stepsContainer">
    <div class="card">
      <div class="section-tag">Project Setup</div>
      <h2>Project Setup</h2>
      <p class="card-desc">Client, site, court configuration, and contractor ‚Äî all in one place.</p>
      
        <div class="sub-heading">Client &amp; Site</div>
        <div class="field-grid">
          <div class="field">
            <label>Client / Project Name</label>
            <input type="text" id="clientName" value="" placeholder="e.g. Smith Residence">
          </div>
          <div class="field">
            <label>Site Address</label>
            <input type="text" id="siteAddress" value="" placeholder="123 Main St, City, State" onblur="lookupTravelTime(this.value)">
          </div>
          <div class="field">
            <label>Permit / Project #</label>
            <input type="text" id="permitNum" value="" placeholder="Optional">
          </div>
          <div class="field">
            <label>Target Completion</label>
            <input type="date" id="targetDate" value="">
          </div>
        </div>

        <hr class="divider">
        <div class="sub-heading">Surface Type</div>
        <div class="option-grid">
          
            <div class="option-card " onclick="data.surfaceType=&#39;concrete&#39;;this.closest(&#39;.option-grid&#39;).querySelectorAll(&#39;.option-card&#39;).forEach(c=&gt;c.classList.remove(&#39;selected&#39;));this.classList.add(&#39;selected&#39;)">
              <span class="opt-icon">üèóÔ∏è</span><span class="opt-label">Concrete</span>
            </div>
            <div class="option-card " onclick="data.surfaceType=&#39;asphalt&#39;;this.closest(&#39;.option-grid&#39;).querySelectorAll(&#39;.option-card&#39;).forEach(c=&gt;c.classList.remove(&#39;selected&#39;));this.classList.add(&#39;selected&#39;)">
              <span class="opt-icon">üî≤</span><span class="opt-label">Asphalt</span>
            </div>
            <div class="option-card " onclick="data.surfaceType=&#39;gravel&#39;;this.closest(&#39;.option-grid&#39;).querySelectorAll(&#39;.option-card&#39;).forEach(c=&gt;c.classList.remove(&#39;selected&#39;));this.classList.add(&#39;selected&#39;)">
              <span class="opt-icon">ü™®</span><span class="opt-label">Gravel / Stone</span>
            </div>
        </div>

        <hr class="divider">
        <div class="sub-heading">Court Type &amp; Size</div>
        <div class="option-grid">
          
            <div class="option-card " onclick="toggleCourtType(&#39;Basketball&#39;,this)">
              <span class="opt-icon">üèÄ</span><span class="opt-label">Basketball</span>
            </div>
            <div class="option-card " onclick="toggleCourtType(&#39;Pickleball&#39;,this)">
              <span class="opt-icon">üè∏</span><span class="opt-label">Pickleball</span>
            </div>
            <div class="option-card " onclick="toggleCourtType(&#39;Tennis&#39;,this)">
              <span class="opt-icon">üéæ</span><span class="opt-label">Tennis</span>
            </div>
            <div class="option-card " onclick="toggleCourtType(&#39;Multi-Sport&#39;,this)">
              <span class="opt-icon">‚öΩ</span><span class="opt-label">Multi-Sport</span>
            </div>
        </div>
        <div class="field-grid" style="margin-top:14px">
          <div class="field">
            <label>Length (ft)</label>
            <input type="number" id="courtL" value="" placeholder="e.g. 94">
          </div>
          <div class="field">
            <label>Width (ft)</label>
            <input type="number" id="courtW" value="" placeholder="e.g. 50">
          </div>
          <div class="field">
            <label>Orientation</label>
            <input type="text" id="orientation" value="" placeholder="e.g. Long axis toward house">
          </div>
        </div>

        <hr class="divider">
        <div class="sub-heading">Contractor</div>
        <div class="field-grid">
          <div class="field full">
            <label>Company Name</label>
            <input type="text" id="contractorName" value="">
          </div>
          <div class="field">
            <label>Foreman</label>
            <input type="text" id="foremanName" value="">
          </div>
          <div class="field">
            <label>Phone</label>
            <input type="text" id="foremanPhone" value="">
          </div>
          <div class="field">
            <label>Email</label>
            <input type="text" id="foremanEmail" value="">
          </div>
        </div>
      <div class="btn-row">
        
        <button class="btn btn-primary" onclick="goNext()">
          Continue ‚Üí
        </button>
      </div>
    </div></div>

  <!-- REPORT -->
  <div id="reportContainer" class="hidden"></div>

</div>

<script>
// ‚îÄ‚îÄ‚îÄ DATA MODEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const data = {};

// ‚îÄ‚îÄ‚îÄ STEP DEFINITIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Steps are defined as objects with a render() and collect() function
const STEPS = [

  // STEP 1: Project Info + Surface + Court + Contractor
  {
    section: 'Project Setup',
    title: 'Project Setup',
    desc: 'Client, site, court configuration, and contractor ‚Äî all in one place.',
    render() {
      const ssel = v => data.surfaceType === v ? 'selected' : '';
      const csel = v => (data.courtTypes||[]).includes(v) ? 'selected' : '';
      return `
        <div class="sub-heading">Client & Site</div>
        <div class="field-grid">
          <div class="field">
            <label>Client / Project Name</label>
            <input type="text" id="clientName" value="${data.clientName||''}" placeholder="e.g. Smith Residence">
          </div>
          <div class="field">
            <label>Site Address</label>
            <input type="text" id="siteAddress" value="${data.siteAddress||''}" placeholder="123 Main St, City, State" onblur="lookupTravelTime(this.value)">
          </div>
          <div class="field">
            <label>Permit / Project #</label>
            <input type="text" id="permitNum" value="${data.permitNum||''}" placeholder="Optional">
          </div>
          <div class="field">
            <label>Target Completion</label>
            <input type="date" id="targetDate" value="${data.targetDate||''}">
          </div>
        </div>

        <hr class="divider">
        <div class="sub-heading">Surface Type</div>
        <div class="option-grid">
          ${[['concrete','üèóÔ∏è','Concrete'],['asphalt','üî≤','Asphalt'],['gravel','ü™®','Gravel / Stone']].map(([val,icon,label])=>`
            <div class="option-card ${ssel(val)}" onclick="data.surfaceType='${val}';this.closest('.option-grid').querySelectorAll('.option-card').forEach(c=>c.classList.remove('selected'));this.classList.add('selected')">
              <span class="opt-icon">${icon}</span><span class="opt-label">${label}</span>
            </div>`).join('')}
        </div>

        <hr class="divider">
        <div class="sub-heading">Court Type & Size</div>
        <div class="option-grid">
          ${[['Basketball','üèÄ'],['Pickleball','üè∏'],['Tennis','üéæ'],['Multi-Sport','‚öΩ']].map(([val,icon])=>`
            <div class="option-card ${csel(val)}" onclick="toggleCourtType('${val}',this)">
              <span class="opt-icon">${icon}</span><span class="opt-label">${val}</span>
            </div>`).join('')}
        </div>
        <div class="field-grid" style="margin-top:14px">
          <div class="field">
            <label>Length (ft)</label>
            <input type="number" id="courtL" value="${data.courtL||''}" placeholder="e.g. 94">
          </div>
          <div class="field">
            <label>Width (ft)</label>
            <input type="number" id="courtW" value="${data.courtW||''}" placeholder="e.g. 50">
          </div>
          <div class="field">
            <label>Orientation</label>
            <input type="text" id="orientation" value="${data.orientation||''}" placeholder="e.g. Long axis toward house">
          </div>
        </div>

        <hr class="divider">
        <div class="sub-heading">Contractor</div>
        <div class="field-grid">
          <div class="field full">
            <label>Company Name</label>
            <input type="text" id="contractorName" value="${data.contractorName||''}">
          </div>
          <div class="field">
            <label>Foreman</label>
            <input type="text" id="foremanName" value="${data.foremanName||''}">
          </div>
          <div class="field">
            <label>Phone</label>
            <input type="text" id="foremanPhone" value="${data.foremanPhone||''}">
          </div>
          <div class="field">
            <label>Email</label>
            <input type="text" id="foremanEmail" value="${data.foremanEmail||''}">
          </div>
        </div>`;
    },
    collect() {
      data.clientName = v('clientName');
      const newAddr = v('siteAddress');
      if (newAddr && newAddr !== data.siteAddress) lookupTravelTime(newAddr);
      data.siteAddress = newAddr;
      data.permitNum  = v('permitNum');
      data.targetDate = v('targetDate');
      data.courtL     = v('courtL');
      data.courtW     = v('courtW');
      data.orientation= v('orientation');
      data.contractorName = v('contractorName');
      data.foremanName    = v('foremanName');
      data.foremanPhone   = v('foremanPhone');
      data.foremanEmail   = v('foremanEmail');
    },
    valid() { return !!(data.clientName && data.siteAddress && data.surfaceType && (data.courtTypes||[]).length); }
  },

  // STEP 2: Accessories
  {
    section: 'Accessories',
    title: 'Court Accessories',
    desc: 'Select equipment. Tier 1 Wholesale pricing. Flat $299 shipping on hoops and lighting.',
    render() {
      var types = data.courtTypes || [];
      var needsHoops = types.indexOf('Basketball') > -1;
      var needsPB    = types.indexOf('Pickleball') > -1;
      if (!data.accessories) data.accessories = {};
      var html = '';
      if (needsHoops) {
        html += '<div class="sub-heading">&#127936; Basketball Hoops</div><div class="product-grid">';
        CATALOG.hoops.forEach(function(p){ html += renderProductCard(p); });
        html += '</div><hr class="divider">';
      }
      if (needsPB) {
        html += '<div class="sub-heading">&#127955; Portable Pickleball Nets</div><div class="product-grid">';
        CATALOG.pickleball_portable.forEach(function(p){ html += renderProductCard(p); });
        html += '</div><div class="sub-heading" style="margin-top:18px">&#9968; Inground &amp; Surface Mount</div><div class="product-grid">';
        CATALOG.pickleball_inground.forEach(function(p){ html += renderProductCard(p); });
        html += '</div><hr class="divider">';
      }
      html += '<div class="sub-heading">&#128161; Court Lighting</div><div class="product-grid">';
      CATALOG.lighting.forEach(function(p){ html += renderProductCard(p); });
      html += '</div>';
      html += renderPriceBar();
      return html;
    },
    collect() {},
    valid() { return true; }
  },

  // STEP 3: Court Finish
  {
    section: 'Court Finish',
    title: 'Court Painting & Finish',
    desc: 'Choose a surface finish. Acrylic paint estimates calculate from your dimensions and travel time.',
    render() {
      var pt  = data.paintType || '';
      var lr  = data.laborRate  !== undefined ? data.laborRate  : 30;
      var otr = data.otRate     !== undefined ? data.otRate     : 45;
      var mk  = data.markupPct  !== undefined ? data.markupPct  : 30;
      var tr  = data.travelHours!== undefined ? data.travelHours: 1;
      var L   = parseFloat(data.courtL) || 60;
      var W   = parseFloat(data.courtW) || 120;
      var html = '<div class="paint-option-grid">';
      html += '<div class="paint-option'+(pt==='acrylic'?' selected':'')+'" onclick="setPaintType(\'acrylic\')"><div class="paint-option-title">&#127912; Acrylic Sports Paint</div><div class="paint-option-desc">Multi-coat system with color, lines &amp; resurfacer.</div></div>';
      html += '<div class="paint-option'+(pt==='tiles'?' selected':'')+'" onclick="setPaintType(\'tiles\')"><div class="paint-option-title">&#9632; Game Tiles</div><div class="paint-option-desc">Modular interlocking sport tiles. Quote added manually.</div></div>';
      html += '<div class="paint-option'+(pt==='none'?' selected':'')+'" onclick="setPaintType(\'none\')"><div class="paint-option-title">&#9744; No Finish / TBD</div><div class="paint-option-desc">To be determined or handled separately.</div></div>';
      html += '</div>';
      if (pt === 'acrylic') {
        html += '<hr class="divider"><div class="sub-heading">Estimate Settings</div><div class="field-grid">';
        html += '<div class="field"><label>Court Length (ft)</label><input type="number" id="pe-L" value="'+L+'" oninput="refreshPaintEst()" min="1"></div>';
        html += '<div class="field"><label>Court Width (ft)</label><input type="number" id="pe-W" value="'+W+'" oninput="refreshPaintEst()" min="1"></div>';
        html += '<div class="field"><label>Labor Rate ($/hr)</label><input type="number" id="pe-lr" value="'+lr+'" oninput="refreshPaintEst()" min="1"></div>';
        html += '<div class="field"><label>OT Rate ($/hr)</label><input type="number" id="pe-ot" value="'+otr+'" oninput="refreshPaintEst()" min="1"></div>';
        html += '<div class="field"><label>Markup (%)</label><input type="number" id="pe-mk" value="'+mk+'" oninput="refreshPaintEst()" min="0"></div>';
        html += '<div class="field"><label>Travel One Way (hrs)</label>'+(data.travelHours?'<div class="travel-badge ok">&#10003; '+data.travelHours.toFixed(1)+' hrs from address</div>':'<div class="travel-badge pending">&#9888; Auto-calculated from address</div>')+'<input type="number" id="pe-trav" value="'+tr+'" oninput="refreshPaintEst()" min="0.1" step="0.1" style="margin-top:6px"></div>';
        html += '</div><div id="paintEstBox">'+buildPaintEst(L,W,lr,otr,mk,tr)+'</div>';
      }
      if (pt === 'tiles') html += '<div style="padding:14px;background:var(--gray-light);border-radius:8px;color:var(--gray);font-size:0.9rem;margin-top:8px">Add tile pricing manually in final notes.</div>';
      return html;
    },
    collect() {
      if (data.paintType === 'acrylic') {
        var L = parseFloat(document.getElementById('pe-L').value)||60;
        var W = parseFloat(document.getElementById('pe-W').value)||120;
        data.laborRate  = parseFloat(document.getElementById('pe-lr').value)||30;
        data.otRate     = parseFloat(document.getElementById('pe-ot').value)||45;
        data.markupPct  = parseFloat(document.getElementById('pe-mk').value)||30;
        data.travelHours= parseFloat(document.getElementById('pe-trav').value)||1;
        data.paintEst   = calcPaint(L,W,data.laborRate,data.otRate,data.markupPct,data.travelHours);
      }
    },
    valid() { return !!data.paintType; }
  },

  // STEP 4: Pre-Construction + Subgrade
  {
    section: 'Pre-Construction',
    title: 'Pre-Construction & Subgrade',
    desc: 'Verify pre-construction checklist and define foundation requirements.',
    render() {
      const checks = [
        ['plansReviewed','Approved plans received and reviewed'],
        ['permitsConfirmed','Survey & permits confirmed'],
        ['utilitiesLocated','Underground utilities located'],
        ['accessConfirmed','Equipment access confirmed'],
        ['existingConditions','Existing site conditions documented'],
        ['ownerNotified','Owner notified of start date'],
        ['materialsOrdered','Materials ordered & delivery scheduled'],
      ];
      return `
        <div class="sub-heading">Pre-Construction Checklist</div>
        <div class="check-list">
          ${checks.map(([k,l])=>`<label class="check-item"><input type="checkbox" id="${k}" ${data[k]?'checked':''}><span class="check-item-label">${l}</span></label>`).join('')}
        </div>
        <div class="field" style="margin-top:14px">
          <label>Pre-Construction Notes</label>
          <textarea id="preconNotes" placeholder="Notes or exceptions...">${data.preconNotes||''}</textarea>
        </div>
        <hr class="divider">
        <div class="sub-heading">Subgrade & Base</div>
        <div class="field-grid">
          <div class="field">
            <label>Base Material</label>
            <select id="baseMaterial">
              <option value="">‚Äî Select ‚Äî</option>
              ${['Compacted Gravel','Crushed Stone','Processed Stone','Existing Subgrade','Other'].map(o=>`<option ${data.baseMaterial===o?'selected':''}>${o}</option>`).join('')}
            </select>
          </div>
          <div class="field">
            <label>Compacted Thickness (in)</label>
            <input type="number" id="baseThickness" value="${data.baseThickness||''}" placeholder="e.g. 6">
          </div>
          <div class="field">
            <label>Geotextile Fabric</label>
            <div class="toggle-row">
              ${['Yes','No'].map(o=>`<button class="toggle-btn ${data.geotextile===o?'active':''}" onclick="setToggle('geotextile','${o}',this)">${o}</button>`).join('')}
            </div>
          </div>
          <div class="field full">
            <label>Subgrade Notes</label>
            <textarea id="subgradeNotes" placeholder="Prep conditions, concerns...">${data.subgradeNotes||''}</textarea>
          </div>
        </div>`;
    },
    collect() {
      ['plansReviewed','permitsConfirmed','utilitiesLocated','accessConfirmed','existingConditions','ownerNotified','materialsOrdered'].forEach(k=>data[k]=document.getElementById(k)?.checked);
      data.preconNotes   = v('preconNotes');
      data.baseMaterial  = v('baseMaterial');
      data.baseThickness = v('baseThickness');
      data.subgradeNotes = v('subgradeNotes');
    },
    valid() { return true; }
  },

  // STEP 5: Surface Specs + Slope & Drainage
  {
    section: 'Surface & Drainage',
    title: 'Surface Specs & Drainage',
    desc: 'Surface material specifications and site drainage.',
    render() {
      const s = data.surfaceType;
      let sf = '';
      if (s === 'asphalt') {
        sf = `
          <div class="field">
            <label>Asphalt Mix</label>
            <select id="asphaltMix"><option value="">‚Äî Select ‚Äî</option>${['9.5mm Fine','12.5mm Medium','19mm Base','Dense Graded'].map(o=>`<option ${data.asphaltMix===o?'selected':''}>${o}</option>`).join('')}</select>
          </div>
          <div class="field">
            <label>Lifts</label>
            <div class="toggle-row">${['1','2'].map(o=>`<button class="toggle-btn ${data.asphaltLifts===o?'active':''}" onclick="setToggle('asphaltLifts','${o}',this);renderStep()">${o} Lift${o==='2'?'s':''}</button>`).join('')}</div>
          </div>
          ${data.asphaltLifts==='2'?`<div class="field"><label>Binder Thickness (in)</label><input type="number" id="binderThick" value="${data.binderThick||''}"></div>`:''}
          <div class="field">
            <label>Surface Lift (in)</label>
            <input type="number" id="surfaceThick" value="${data.surfaceThick||''}" placeholder="e.g. 1.5">
          </div>`;
      } else if (s === 'concrete') {
        sf = `
          <div class="field"><label>PSI</label><select id="concretePSI"><option value="">‚Äî Select ‚Äî</option>${['3000 PSI','3500 PSI','4000 PSI','4500 PSI','5000 PSI'].map(o=>`<option ${data.concretePSI===o?'selected':''}>${o}</option>`).join('')}</select></div>
          <div class="field"><label>Thickness (in)</label><input type="number" id="concreteThick" value="${data.concreteThick||''}"></div>
          <div class="field"><label>Perimeter Turn Down</label><div class="toggle-row">${[['6x6','6&quot; √ó 6&quot;'],['None','None'],['Other','Other']].map(([val,label])=>`<button class="toggle-btn ${data.turnDown===val?'active':''}" onclick="setToggle('turnDown','${val}',this)">${label}</button>`).join('')}</div></div>
          <div class="field"><label>Fiber Reinforce</label><div class="toggle-row">${['Yes','No'].map(o=>`<button class="toggle-btn ${data.fiberReinforce===o?'active':''}" onclick="setToggle('fiberReinforce','${o}',this)">${o}</button>`).join('')}</div></div>
          <div class="field"><label>Vapor Barrier</label><div class="toggle-row">${['Yes','No'].map(o=>`<button class="toggle-btn ${data.vaporBarrier===o?'active':''}" onclick="setToggle('vaporBarrier','${o}',this)">${o}</button>`).join('')}</div></div>
          <div class="field"><label>Surface Finish</label><select id="concreteFinish"><option value="">‚Äî Select ‚Äî</option>${['Broom Finish','Smooth Trowel','Exposed Aggregate','Brushed'].map(o=>`<option ${data.concreteFinish===o?'selected':''}>${o}</option>`).join('')}</select></div>
          <div class="field"><label>Control Joint Spacing (ft)</label><input type="number" id="jointSpacing" value="${data.jointSpacing||''}"></div>`;
      } else if (s === 'gravel') {
        sf = `
          <div class="field full"><label>Gravel Type</label><select id="gravelType"><option value="">‚Äî Select ‚Äî</option>${['Crushed Stone #57','Crushed Stone #21A','Decomposed Granite','Pea Gravel','Limestone Screenings'].map(o=>`<option ${data.gravelType===o?'selected':''}>${o}</option>`).join('')}</select></div>
          <div class="field"><label>Top Layer (in)</label><input type="number" id="gravelThick" value="${data.gravelThick||''}"></div>
          <div class="field"><label>Framing</label><div class="toggle-row">${['PT Lumber','Steel Edging','None'].map(o=>`<button class="toggle-btn ${data.gravelFraming===o?'active':''}" onclick="setToggle('gravelFraming','${o}',this)">${o}</button>`).join('')}</div></div>`;
      }
      return `
        <div class="sub-heading">Surface Specifications ‚Äî ${s||'(select surface in Step 1)'}</div>
        <div class="field-grid">${sf}</div>
        <div class="field" style="margin-top:4px"><label>Surface Notes</label><textarea id="surfaceNotes" placeholder="Additional specs...">${data.surfaceNotes||''}</textarea></div>
        <hr class="divider">
        <div class="sub-heading">Slope & Drainage</div>
        <div class="field-grid">
          <div class="field"><label>Finished Slope (%)</label><input type="number" id="slope" value="${data.slope||''}" step="0.1" placeholder="e.g. 1.0"></div>
          <div class="field"><label>Slope Direction</label><select id="slopeDir"><option value="">‚Äî Select ‚Äî</option>${['Single Plane','Crown','Toward Drain','Side to Side','End to End'].map(o=>`<option ${data.slopeDir===o?'selected':''}>${o}</option>`).join('')}</select></div>
          <div class="field"><label>French Drain</label><div class="toggle-row">${['None','Perimeter','One Side','Two Sides'].map(o=>`<button class="toggle-btn ${data.frenchDrain===o?'active':''}" onclick="setToggle('frenchDrain','${o}',this)">${o}</button>`).join('')}</div></div>
          ${data.frenchDrain&&data.frenchDrain!=='None'?`<div class="field"><label>Drain Length (ft)</label><input type="number" id="drainLength" value="${data.drainLength||''}"></div><div class="field"><label>Discharge Point</label><input type="text" id="drainDischarge" value="${data.drainDischarge||''}" placeholder="e.g. Daylight, Dry Well"></div>`:''}
          <div class="field"><label>Retaining Wall</label><div class="toggle-row">${['Yes','No'].map(o=>`<button class="toggle-btn ${data.retainingWall===o?'active':''}" onclick="setToggle('retainingWall','${o}',this);renderStep()">${o}</button>`).join('')}</div></div>
        </div>
        ${data.retainingWall==='Yes'?`<div class="field-grid" style="margin-top:12px"><div class="field"><label>Wall Height (ft)</label><input type="number" id="wallH" value="${data.wallH||''}"></div><div class="field"><label>Wall Length (ft)</label><input type="number" id="wallL" value="${data.wallL||''}"></div><div class="field"><label>Wall Material</label><select id="wallMaterial"><option value="">‚Äî Select ‚Äî</option>${['Concrete Block','Natural Stone','Timber','Poured Concrete','Segmental Block'].map(o=>`<option ${data.wallMaterial===o?'selected':''}>${o}</option>`).join('')}</select></div></div>`:''}`;
    },
    collect() {
      data.asphaltMix=v('asphaltMix'); data.surfaceThick=v('surfaceThick'); data.binderThick=v('binderThick');
      data.concretePSI=v('concretePSI'); data.concreteThick=v('concreteThick');
      data.concreteFinish=v('concreteFinish'); data.jointSpacing=v('jointSpacing');
      data.gravelType=v('gravelType'); data.gravelThick=v('gravelThick');
      data.surfaceNotes=v('surfaceNotes');
      data.slope=v('slope'); data.slopeDir=v('slopeDir');
      data.drainLength=v('drainLength'); data.drainDischarge=v('drainDischarge');
      data.wallH=v('wallH'); data.wallL=v('wallL'); data.wallMaterial=v('wallMaterial');
    },
    valid() { return true; }
  },

  // STEP 6: Edges, Fencing & Site
  {
    section: 'Edges, Fencing & Site',
    title: 'Edges, Backfill, Fencing & Site Conditions',
    desc: 'Perimeter edge treatment, fencing requirements, erosion control, and site access.',
    render() {
      return `
        <div class="sub-heading">Edges & Backfill</div>
        <div class="field-grid">
          <div class="field full"><label>Edge Finishing</label><div class="toggle-row">${['Spread Excavated Fill','Spread Fill & Seed','Topsoil & Seed','Topsoil & Sod','Gravel','Other'].map(o=>`<button class="toggle-btn ${data.backfillMethod===o?'active':''}" onclick="setToggle('backfillMethod','${o}',this);document.getElementById('backfillOther').style.display=this.textContent==='Other'?'block':'none'">${o}</button>`).join('')}</div>
            <input type="text" id="backfillOther" placeholder="Describe edge finishing method..." value="${data.backfillOtherText||''}" style="display:${data.backfillMethod==='Other'?'block':'none'};margin-top:8px" oninput="data.backfillOtherText=this.value">
          </div>
          <div class="field full"><label>Excavated Material</label><div class="toggle-row">${['Stockpile On Site','Spread On Site','Haul Away'].map(o=>`<button class="toggle-btn ${data.excavatedMaterial===o?'active':''}" onclick="setToggle('excavatedMaterial','${o}',this)">${o}</button>`).join('')}</div></div>
          <div class="field"><label>Backfill Notes</label><textarea id="backfillNotes" placeholder="Edge treatment details...">${data.backfillNotes||''}</textarea></div>
          <div class="field"><label>Tolerance Notes</label><textarea id="toleranceNotes" placeholder="e.g. 3/16 in 10ft tolerance...">${data.toleranceNotes||''}</textarea></div>
        </div>
        <hr class="divider">
        <div class="sub-heading">Fencing</div>
        <div class="toggle-row" style="margin-bottom:16px">
          <button class="toggle-btn ${data.fencingRequired==='Yes'?'active':''}" onclick="setToggle('fencingRequired','Yes',this);renderStep()">Required</button>
          <button class="toggle-btn ${data.fencingRequired==='No'?'active':''}" onclick="setToggle('fencingRequired','No',this);renderStep()">Not Required</button>
        </div>
        ${data.fencingRequired==='Yes'?`
        <div class="field-grid">
          <div class="field"><label>Height (ft)</label><input type="number" id="fenceHeight" value="${data.fenceHeight||''}"></div>
          <div class="field"><label>Type</label><div class="toggle-row">${['Chain Link','Welded Wire','Wood','Vinyl','Aluminum'].map(o=>`<button class="toggle-btn ${data.fenceType===o?'active':''}" onclick="setToggle('fenceType','${o}',this)">${o}</button>`).join('')}</div></div>
          <div class="field"><label>Finish</label><div class="toggle-row">${['Galvanized','Black Vinyl','Green Vinyl','Powder Coated'].map(o=>`<button class="toggle-btn ${data.fenceFinish===o?'active':''}" onclick="setToggle('fenceFinish','${o}',this)">${o}</button>`).join('')}</div></div>
          <div class="field"><label>Linear Feet</label><input type="number" id="fenceLength" value="${data.fenceLength||''}"></div>
          <div class="field"><label>Gates</label><input type="text" id="fenceGates" value="${data.fenceGates||''}" placeholder="e.g. 2x 4ft walk gates"></div>
          <div class="field"><label>Windscreen</label><div class="toggle-row">${['Yes','No'].map(o=>`<button class="toggle-btn ${data.windscreen===o?'active':''}" onclick="setToggle('windscreen','${o}',this)">${o}</button>`).join('')}</div></div>
          <div class="field"><label>Purpose</label><div class="toggle-row">${['Ball Containment','Security','Privacy','Decorative'].map(o=>`<button class="toggle-btn ${data.fencePurpose===o?'active':''}" onclick="setToggle('fencePurpose','${o}',this)">${o}</button>`).join('')}</div></div>
        </div>`:''}
        <hr class="divider">
        <div class="sub-heading">Erosion Control & Site Access</div>
        <div class="check-list">
          ${[['siltFence','Silt Fence'],['accessRoad','Access Road / Stone Pad'],['stoneWashout','Stone Washout Area'],['inletProtection','Storm Inlet Protection'],['seedingRequired','Seeding / Stabilization'],['surveyRequired','Survey Required']].map(([k,l])=>`<label class="check-item"><input type="checkbox" id="${k}" ${data[k]?'checked':''}><span class="check-item-label">${l}</span></label>`).join('')}
        </div>
        <div class="field-grid" style="margin-top:14px">
          <div class="field"><label>Min Access Width (ft)</label><input type="number" id="accessWidth" value="${data.accessWidth||''}"></div>
          <div class="field"><label>Elevation Changes</label><div class="toggle-row">${['Minimal','Moderate','Significant'].map(o=>`<button class="toggle-btn ${data.elevationChanges===o?'active':''}" onclick="setToggle('elevationChanges','${o}',this)">${o}</button>`).join('')}</div></div>
          <div class="field full"><label>Access Challenges</label><textarea id="accessChallenges" placeholder="Gates, overhead wires, soft ground, etc.">${data.accessChallenges||''}</textarea></div>
        </div>`;
    },
    collect() {
      data.backfillNotes      = v('backfillNotes');
      data.toleranceNotes     = v('toleranceNotes');
      data.backfillOtherText  = v('backfillOther');
      data.fenceHeight    = v('fenceHeight');
      data.fenceLength    = v('fenceLength');
      data.fenceGates     = v('fenceGates');
      ['siltFence','accessRoad','stoneWashout','inletProtection','seedingRequired','surveyRequired'].forEach(k=>data[k]=document.getElementById(k)?.checked);
      data.accessWidth      = v('accessWidth');
      data.accessChallenges = v('accessChallenges');
    },
    valid() { return true; }
  },

  // STEP 7: Attachments & Notes
  {
    section: 'Final Notes',
    title: 'Attachments & Notes',
    desc: 'Document attachments and final project instructions.',
    render() {
      const atts = [['attSurvey','Survey'],['attPlan','Plan Sketch'],['attPhotos','Site Photos'],['attElevation','Elevation Drawing'],['attSoils','Soils Report'],['attPermit','Permit Copy']];
      return `
        <div class="sub-heading">Attachments Included</div>
        <div class="check-list">
          ${atts.map(([k,l])=>`<label class="check-item"><input type="checkbox" id="${k}" ${data[k]?'checked':''}><span class="check-item-label">${l}</span></label>`).join('')}
        </div>
        <div class="field" style="margin-top:20px">
          <label>Special Instructions / Final Notes</label>
          <textarea id="finalNotes" style="min-height:100px" placeholder="Additional scope, special requirements, or contractor notes...">${data.finalNotes||''}</textarea>
        </div>`;
    },
    collect() {
      ['attSurvey','attPlan','attPhotos','attElevation','attSoils','attPermit'].forEach(k=>data[k]=document.getElementById(k)?.checked);
      data.finalNotes = v('finalNotes');
    },
    valid() { return true; }
  },
];

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentStep = 0;

function v(id) {
  const el = document.getElementById(id);
  return el ? el.value.trim() : '';
}

function selectOpt(key, val, el) {
  data[key] = val;
  el.closest('.option-grid').querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
}

function toggleOpt(key, val, el, event) {
  if (event) event.preventDefault();
  if (!data[key]) data[key] = [];
  const idx = data[key].indexOf(val);
  if (idx > -1) {
    data[key].splice(idx, 1);
    el.classList.remove('selected');
  } else {
    data[key].push(val);
    el.classList.add('selected');
  }
}

function toggleCourtType(val, el) {
  if (!data.courtTypes) data.courtTypes = [];
  const idx = data.courtTypes.indexOf(val);
  if (idx > -1) {
    data.courtTypes.splice(idx, 1);
    el.classList.remove('selected');
  } else {
    data.courtTypes.push(val);
    el.classList.add('selected');
  }
}

function setToggle(key, val, el) {
  data[key] = val;
  el.closest('.toggle-row').querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ RENDER STEP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderStep() {
  const total = STEPS.length;
  const pct = Math.round((currentStep / total) * 100);

  document.getElementById('stepLabel').textContent = `Step ${currentStep + 1} of ${total}`;
  document.getElementById('stepCount').textContent = STEPS[currentStep].section;
  document.getElementById('progressFill').style.width = pct + '%';

  // dots
  const dots = document.getElementById('stepDots');
  dots.innerHTML = STEPS.map((_, i) => `<div class="step-dot ${i < currentStep ? 'done' : i === currentStep ? 'active' : ''}"></div>`).join('');

  const step = STEPS[currentStep];
  const container = document.getElementById('stepsContainer');
  container.innerHTML = `
    <div class="card">
      <div class="section-tag">${step.section}</div>
      <h2>${step.title}</h2>
      <p class="card-desc">${step.desc}</p>
      ${step.render()}
      <div class="btn-row">
        ${currentStep > 0 ? `<button class="btn btn-secondary" onclick="goBack()">‚Üê Back</button>` : ''}
        <button class="btn btn-primary" onclick="goNext()">
          ${currentStep < STEPS.length - 1 ? 'Continue ‚Üí' : 'Generate Report ‚úì'}
        </button>
      </div>
    </div>`;
}

function goNext() {
  STEPS[currentStep].collect();
  if (STEPS[currentStep].valid && !STEPS[currentStep].valid()) {
    alert('Please fill in the required fields before continuing.');
    return;
  }
  if (currentStep < STEPS.length - 1) {
    currentStep++;
    renderStep();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } else {
    generateReport();
  }
}

function goBack() {
  STEPS[currentStep].collect();
  currentStep--;
  renderStep();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ‚îÄ‚îÄ‚îÄ REPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function buildAccessoriesReport() {
  var accs = Object.entries(data.accessories||{}).filter(function(e){ return e[1].selected; });
  if (!accs.length) return '';
  var nameMap = {};
  [].concat(CATALOG.hoops, CATALOG.pickleball_portable, CATALOG.pickleball_inground, CATALOG.lighting).forEach(function(p){ nameMap[p.id] = p.name; });
  var t = getAccSubtotal();
  var rows = accs.map(function(e){
    var id=e[0], acc=e[1];
    return '<tr><td>'+(nameMap[id]||id)+'</td><td style="text-align:center">'+acc.qty+'</td><td style="text-align:right">$'+acc.price.toLocaleString()+'</td><td style="text-align:right">$'+(acc.price*acc.qty).toLocaleString()+'</td></tr>';
  }).join('');
  return '<div class="report-section"><div class="report-section-title">Accessories &amp; Equipment</div>' +
    '<table class="acc-table"><thead><tr><th>Item</th><th style="text-align:center">Qty</th><th style="text-align:right">Unit</th><th style="text-align:right">Total</th></tr></thead><tbody>' +
    rows +
    '<tr class="acc-total-row"><td colspan="3" style="text-align:right;color:#94a3b8;font-size:0.78rem">Subtotal</td><td style="text-align:right">$'+t.subtotal.toLocaleString()+'</td></tr>' +
    '<tr><td colspan="3" style="text-align:right;color:#94a3b8;font-size:0.78rem">Shipping</td><td style="text-align:right">$'+t.shipping+'</td></tr>' +
    (data.taxExempt
      ? '<tr><td colspan="3" style="text-align:right;color:#38a169;font-size:0.78rem">Tax</td><td style="text-align:right;color:#38a169">Exempt</td></tr>'
      : '<tr><td colspan="3" style="text-align:right;color:#94a3b8;font-size:0.78rem">Est. Tax (7%)</td><td style="text-align:right">$'+Math.round(t.tax).toLocaleString()+'</td></tr>') +
    '<tr style="background:#f8fafc"><td colspan="3" style="text-align:right;font-weight:800;font-size:1rem">Total</td><td style="text-align:right;font-weight:800;font-size:1rem;color:#0f4a91">$'+Math.round(t.total).toLocaleString()+'</td></tr>' +
    '</tbody></table>' +
    '<div style="margin-top:8px;font-size:0.73rem;color:#94a3b8">Tier 1 Wholesale &middot; Flat $299 shipping (waived on pickleball nets) &middot; '+(data.taxExempt?'Tax exempt order':'Tax estimate only')+'</div>' +
    '</div><hr class="report-divider">';
}

function buildPaintReport() {
  if (!data.paintType || data.paintType === 'none') return '';
  if (data.paintType === 'tiles') {
    return '<div class="report-section"><div class="report-section-title">Court Finish</div>' +
      '<div class="report-grid"><div class="report-field"><div class="report-field-label">Finish Type</div><div class="report-field-value">Game Tiles (custom quote)</div></div></div>' +
      '</div><hr class="report-divider">';
  }
  var e = data.paintEst;
  if (!e) return '';
  return '<div class="report-section"><div class="report-section-title">Acrylic Paint Estimate</div>' +
    '<table class="acc-table"><thead><tr><th>Item</th><th style="text-align:right">Amount</th></tr></thead><tbody>' +
    '<tr><td>Court Size</td><td style="text-align:right">'+e.sqFt.toLocaleString()+' sq ft ('+e.sqYd.toLocaleString()+' sq yds)</td></tr>' +
    '<tr><td>Materials</td><td style="text-align:right">$'+e.matTotal.toLocaleString()+'</td></tr>' +
    '<tr><td>Regular Labor ('+e.regHrs+' hrs @ $'+e.lr+'/hr)</td><td style="text-align:right">$'+Math.round(e.regHrs*e.lr).toLocaleString()+'</td></tr>' +
    (e.otHrs > 0 ? '<tr><td>Overtime ('+e.otHrs+' hrs @ $'+e.otr+'/hr)</td><td style="text-align:right">$'+Math.round(e.otHrs*e.otr).toLocaleString()+'</td></tr>' : '') +
    '<tr><td>Travel ('+e.trav+' hr one way &rarr; '+e.travHrs+' total hrs)</td><td style="text-align:right">Included in labor</td></tr>' +
    '<tr class="acc-total-row"><td>Subtotal</td><td style="text-align:right">$'+e.subtotal.toLocaleString()+'</td></tr>' +
    '<tr><td>Markup ('+e.mk+'%)</td><td style="text-align:right">$'+e.markup.toLocaleString()+'</td></tr>' +
    '<tr style="background:#f8fafc"><td style="font-weight:800;font-size:1rem">Total Paint Estimate</td><td style="text-align:right;font-weight:800;font-size:1rem;color:#0f4a91">$'+e.total.toLocaleString()+'</td></tr>' +
    '</tbody></table>' +
    '</div><hr class="report-divider">';
}

function generateReport() {
  document.getElementById('stepsContainer').classList.add('hidden');
  document.getElementById('progressWrap').classList.add('hidden');

  const date = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  const surfaceLabel = { concrete: 'Concrete', asphalt: 'Asphalt', gravel: 'Gravel / Stone' }[data.surfaceType] || data.surfaceType;

  const preconChecks = [
    ['plansReviewed','Approved plans received and reviewed'],
    ['permitsConfirmed','Survey & Permits confirmed'],
    ['elevationConfirmed','Finished elevation confirmed with owner'],
    ['drainagePlanReviewed','Drainage plan reviewed'],
    ['utilitiesMarked','Underground utilities marked (811)'],
    ['accessConfirmed','Access & staging area confirmed'],
    ['weatherOk','Weather window acceptable'],
  ];

  const attachments = [
    ['attSurvey','Survey'],
    ['attPlan','Plan Sketch'],
    ['attPhotos','Site Photos'],
    ['attElevation','Elevation Reference'],
  ].filter(([k]) => data[k]).map(([,l]) => l);

  const erosionFlags = [
    ['siltFence','Silt Fence'],
    ['accessRoad','Access Road'],
    ['drainageNeeded','Drainage'],
    ['stormwaterPermit','Stormwater Permit'],
    ['soilConsNotif','Soil Conservation Notification'],
  ].filter(([k]) => data[k]).map(([,l]) => l);

  function field(label, val, empty = '‚Äî') {
    const display = val ? val : `<span class="report-field-value empty">${empty}</span>`;
    return `<div class="report-field"><div class="report-field-label">${label}</div><div class="report-field-value">${val || `<span class="report-field-value empty">${empty}</span>`}</div></div>`;
  }

  function fieldFull(label, val, empty='‚Äî') {
    return `<div class="report-field full"><div class="report-field-label">${label}</div><div class="report-field-value">${val || `<span class="report-field-value empty">${empty}</span>`}</div></div>`;
  }

  let surfaceSection = '';
  if (data.surfaceType === 'asphalt') {
    surfaceSection = `
      <div class="report-section">
        <div class="report-section-title">Asphalt Specifications</div>
        <div class="report-grid">
          ${field('Asphalt Mix', data.asphaltMix)}
          ${field('Total Compacted Thickness', data.totalThickness ? data.totalThickness + ' in' : '')}
          ${field('Placement Method', data.placementMethod)}
          ${data.placementMethod === 'Two Lifts' ? field('Lift Thicknesses', [data.lift1, data.lift2].filter(Boolean).join(' / ') + ' in') : ''}
        </div>
      </div>`;
  } else if (data.surfaceType === 'concrete') {
    surfaceSection = `
      <div class="report-section">
        <div class="report-section-title">Concrete Specifications</div>
        <div class="report-grid">
          ${field('Concrete PSI', data.concretePSI)}
          ${field('Curing Compounds Allowed', data.curingAllowed)}
          ${field('Vapor Barrier Thickness', data.vaporMil ? data.vaporMil + ' mil' : '')}
          ${field('Perimeter Turn Down', data.turnDown)}
          ${field('Reinforcement', data.reinforcement)}
          ${field('Surface Finish', data.finishType)}
          ${field('Control Joints', data.controlJoint)}
          ${data.mixNotes ? fieldFull('Mix Notes', data.mixNotes) : ''}
        </div>
      </div>`;
  } else {
    surfaceSection = `
      <div class="report-section">
        <div class="report-section-title">Gravel/Stone Details</div>
        <div class="report-grid">
          ${field('Leveling Course Material', data.levelingMaterial)}
          ${field('Leveling Course Thickness', data.levelingThickness ? data.levelingThickness + ' in' : '')}
          ${field('Framing Material', data.framingMaterial)}
          ${data.gravelNotes ? fieldFull('Notes', data.gravelNotes) : ''}
        </div>
      </div>`;
  }

  let fencingSection = '';
  if (data.fencingRequired === 'Yes') {
    fencingSection = `
      <div class="report-section">
        <div class="report-section-title">Fencing</div>
        <div class="report-grid">
          ${field('Purpose', data.fencePurpose)}
          ${field('Height', data.fenceHeight ? data.fenceHeight + ' ft' : '')}
          ${field('Type', data.fenceType)}
          ${field('Finish', data.fenceFinish)}
          ${field('Color / HOA', data.fenceColor)}
          ${field('Distance From Play Area', data.fenceDist ? data.fenceDist + ' ft' : '')}
          ${field('Windscreen', data.windscreen)}
          ${field('Post Spacing', data.postSpacing ? data.postSpacing + ' ft' : '')}
          ${field('Install Type', data.fenceInstallType)}
          ${field('Ground / Post Type', data.groundType)}
          ${field('Gates', data.gateCount ? data.gateCount + ' gate(s), ' + (data.gateWidth||'') + ' wide' : '')}
          ${field('Gate Swing', data.gateSwing)}
          ${field('Gate Hardware', data.gateHardware)}
        </div>
      </div>`;
  }

  const scopeItems = {
    concrete: ['Excavate Area','Prepare and compact subgrade and base','Forms well supported & straight','Install Vapor Barrier & Rebar','Pour Concrete & Finish Uniformly','Sawcut & Remove Forms','Backfill Against Exposed Concrete Edges'],
    asphalt: ['Excavate Area','Prepare subgrade and base','Install asphalt pavement','Deliver surface suitable for sports court coating or game tile'],
    gravel: ['Excavate Area','Prepare and compact subgrade and base','Install permanent pressure treated forms','Leveling Course Uniform & Well Compacted','Backfill Against Exposed Frame Edges'],
  }[data.surfaceType] || [];

  const html = `
    <div class="report-wrap">
      <div class="report-header">
        <div style="font-family:'Barlow Condensed',sans-serif;font-size:0.7rem;font-weight:700;letter-spacing:0.18em;text-transform:uppercase;color:#f0a500;margin-bottom:6px;">My Backyard Sports ¬∑ Scope Report</div>
        <h1>${data.clientName || 'Untitled Project'}</h1>
        <div class="report-meta">${data.siteAddress||''} &nbsp;¬∑&nbsp; ${surfaceLabel} Court &nbsp;¬∑&nbsp; Generated ${date}</div>
      </div>

      <div class="report-body">

        <!-- ROW 1: Project ID + Contractor -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0;margin-bottom:0">
          <div class="report-section" style="margin-bottom:0;border-right:1px solid #e2e8f0;padding-right:20px">
            <div class="report-section-title">Project Identification</div>
            <div class="report-grid">
              ${field('Client', data.clientName)}
              ${field('Address', data.siteAddress)}
              ${field('Permit #', data.permitNum)}
              ${field('Target Date', data.targetDate)}
              ${field('Surface', surfaceLabel)}
              ${field('Court Type(s)', (data.courtTypes||[]).join(', '))}
              ${field('Court Size', data.courtL&&data.courtW ? data.courtL+' √ó '+data.courtW+' ft' : '')}
              ${field('Orientation', data.orientation)}
            </div>
          </div>
          <div class="report-section" style="margin-bottom:0;padding-left:20px">
            <div class="report-section-title">Contractor</div>
            <div class="report-grid">
              ${field('Company', data.contractorName)}
              ${field('Foreman', data.foremanName)}
              ${field('Phone', data.foremanPhone)}
              ${field('Email', data.foremanEmail)}
            </div>
          </div>
        </div>

        <hr class="report-divider">

        <!-- ROW 2: Pre-Construction + Scope of Work -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0;margin-bottom:0">
          <div class="report-section" style="margin-bottom:0;border-right:1px solid #e2e8f0;padding-right:20px">
            <div class="report-section-title">Pre-Construction Verification</div>
            <ul class="scope-list">
              ${preconChecks.filter(([k])=>data[k]).map(([,l])=>`<li>${l}</li>`).join('')}
              ${preconChecks.filter(([k])=>!data[k]).map(([,l])=>`<li style="opacity:0.3;text-decoration:line-through">${l}</li>`).join('')}
            </ul>
            ${data.preconNotes?`<div style="margin-top:8px;font-size:0.82rem;color:#718096"><strong>Notes:</strong> ${data.preconNotes}</div>`:''}
          </div>
          <div class="report-section" style="margin-bottom:0;padding-left:20px">
            <div class="report-section-title">Scope of Work</div>
            <ul class="scope-list">
              ${scopeItems.map(i=>`<li>${i}</li>`).join('')}
            </ul>
            <div style="margin-top:10px;font-size:0.78rem;color:#718096;font-style:italic">Contractor shall not modify scope without written approval.</div>
          </div>
        </div>

        <hr class="report-divider">

        <!-- ROW 3: Subgrade + Surface Specs -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0;margin-bottom:0">
          <div class="report-section" style="margin-bottom:0;border-right:1px solid #e2e8f0;padding-right:20px">
            <div class="report-section-title">Subgrade & Base</div>
            <div class="report-grid">
              ${field('Base Material', data.baseMaterial)}
              ${field('Compacted Thickness', data.baseThickness ? data.baseThickness+' in' : '')}
              ${field('Geotextile Fabric', data.geotextile)}
              ${data.subgradeNotes ? fieldFull('Prep Notes', data.subgradeNotes) : ''}
            </div>
          </div>
          <div class="report-section" style="margin-bottom:0;padding-left:20px">
            <div class="report-section-title">Surface Specifications</div>
            ${surfaceSection}
          </div>
        </div>

        <hr class="report-divider">

        <!-- ROW 4: Slope & Drainage + Edges & Backfill -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0;margin-bottom:0">
          <div class="report-section" style="margin-bottom:0;border-right:1px solid #e2e8f0;padding-right:20px">
            <div class="report-section-title">Slope & Drainage</div>
            <div class="report-grid">
              ${field('Finished Slope', data.slope ? data.slope+'%' : '')}
              ${field('Slope Direction', data.slopeDir)}
              ${field('French Drain', data.frenchDrain)}
              ${data.frenchDrain&&data.frenchDrain!=='None' ? field('Drain Length', data.drainLength ? data.drainLength+' ft' : '') : ''}
              ${field('Discharge', data.drainDischarge)}
              ${field('Retaining Wall', data.retainingWall)}
              ${data.retainingWall==='Yes' ? field('Wall Dimensions', data.wallH&&data.wallL ? data.wallH+' √ó '+data.wallL+' ft' : '') : ''}
              ${data.retainingWall==='Yes' ? field('Wall Material', data.wallMaterial) : ''}
            </div>
            <div style="margin-top:8px;font-size:0.75rem;color:#718096;font-style:italic">No standing water >1/16" after 1hr sun / 2hrs overcast.</div>
          </div>
          <div class="report-section" style="margin-bottom:0;padding-left:20px">
            <div class="report-section-title">Edges & Backfill</div>
            <div class="report-grid">
              ${field('Edge Finishing', data.backfillMethod==='Other' && data.backfillOtherText ? data.backfillOtherText : data.backfillMethod)}
              ${field('Excavated Material', data.excavatedMaterial)}
              ${data.backfillNotes ? fieldFull('Backfill Notes', data.backfillNotes) : ''}
              ${data.toleranceNotes ? fieldFull('Tolerance Notes', data.toleranceNotes) : ''}
            </div>
          </div>
        </div>

        <hr class="report-divider">

        <!-- ROW 5: Fencing + Site Conditions (fencing full-width only if required) -->
        ${data.fencingRequired==='Yes' ? `
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0;margin-bottom:0">
          <div class="report-section" style="margin-bottom:0;border-right:1px solid #e2e8f0;padding-right:20px">
            <div class="report-section-title">Fencing</div>
            <div class="report-grid">
              ${field('Purpose', data.fencePurpose)}
              ${field('Height', data.fenceHeight ? data.fenceHeight+' ft' : '')}
              ${field('Type', data.fenceType)}
              ${field('Finish', data.fenceFinish)}
              ${field('Linear Feet', data.fenceLength ? data.fenceLength+' ft' : '')}
              ${field('Gates', data.fenceGates)}
              ${field('Windscreen', data.windscreen)}
            </div>
          </div>
          <div class="report-section" style="margin-bottom:0;padding-left:20px">
            <div class="report-section-title">Site Conditions & Erosion</div>
            ${erosionFlags.length ? `<ul class="scope-list">${erosionFlags.map(f=>`<li>${f}</li>`).join('')}</ul>` : '<div style="font-size:0.85rem;color:#94a3b8">No erosion items flagged.</div>'}
            <div class="report-grid" style="margin-top:10px">
              ${field('Min Access Width', data.accessWidth ? data.accessWidth+' ft' : '')}
              ${data.elevationChanges ? field('Elevation', data.elevationChanges) : ''}
              ${data.accessChallenges ? fieldFull('Access Notes', data.accessChallenges) : ''}
            </div>
            ${erosionFlags.length ? '<div class="warn-badge">‚ö†Ô∏è Survey required with flagged items</div>' : ''}
          </div>
        </div>
        <hr class="report-divider">
        ` : `
        <div class="report-section" style="margin-bottom:0">
          <div class="report-section-title">Site Conditions & Erosion</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:0">
            <div>
              ${erosionFlags.length ? `<ul class="scope-list">${erosionFlags.map(f=>`<li>${f}</li>`).join('')}</ul>` : '<div style="font-size:0.85rem;color:#94a3b8">No erosion items flagged.</div>'}
              ${erosionFlags.length ? '<div class="warn-badge">‚ö†Ô∏è Survey required with flagged items</div>' : ''}
            </div>
            <div class="report-grid">
              ${field('Min Access Width', data.accessWidth ? data.accessWidth+' ft' : '')}
              ${data.elevationChanges ? field('Elevation', data.elevationChanges) : ''}
              ${data.accessChallenges ? fieldFull('Access Notes', data.accessChallenges) : ''}
            </div>
          </div>
        </div>
        <hr class="report-divider">
        `}

        <!-- Accessories & Equipment (full width) -->
        ${buildAccessoriesReport()}

        <!-- Paint Estimate (full width) -->
        ${buildPaintReport()}

        <!-- Attachments & Notes (full width) -->
        <div class="report-section" style="margin-bottom:0">
          <div class="report-section-title">Attachments & Notes</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
            <div>
              ${attachments.length ? `<ul class="scope-list">${attachments.map(a=>`<li>${a}</li>`).join('')}</ul>` : '<div style="font-size:0.85rem;color:#94a3b8">No attachments noted.</div>'}
            </div>
            <div>
              ${data.finalNotes ? `<div style="padding:12px;background:#f8fafc;border-radius:6px;border-left:3px solid var(--blue);font-size:0.88rem;color:var(--text)"><strong>Special Instructions:</strong><br>${data.finalNotes}</div>` : ''}
            </div>
          </div>
        </div>

      </div>

      <div class="report-footer">
        <button class="btn btn-secondary" onclick="restart()">‚Üê Start New Quote</button>
        <button class="btn btn-accent" onclick="printReport()">üñ® Print / Save PDF</button>
      </div>
    </div>

`
  document.getElementById('reportContainer').innerHTML = html;
  document.getElementById('reportContainer').classList.remove('hidden');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}


function printReport() {
  const reportHTML = document.getElementById('reportContainer').innerHTML;
  const win = window.open('', '_blank', 'width=900,height=700');
  win.document.write(`<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MBS Scope Report - ${data.clientName || 'Project'}</title>
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
    body { font-family: 'Barlow', sans-serif; background: #fff; color: #1a202c; }
    .report-wrap { max-width: 860px; margin: 0 auto; }
    .report-header { background: #0a1628 !important; padding: 24px 32px; border-bottom: 4px solid #f0a500; }
    .report-header h1 { font-family: 'Barlow Condensed', sans-serif; font-weight: 800; font-size: 1.6rem; color: #ffffff; margin-bottom: 4px; }
    .report-meta { color: #94b3d8; font-size: 0.88rem; }
    .report-body { padding: 28px 32px; }
    .report-section { margin-bottom: 22px; page-break-inside: avoid; }
    .report-section-title { font-family: 'Barlow Condensed', sans-serif; font-size: 0.72rem; font-weight: 700; letter-spacing: 0.16em; text-transform: uppercase; color: #1a6dcc; background: #e8f1fb !important; padding: 3px 10px; border-radius: 4px; display: inline-block; margin-bottom: 12px; }
    .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 20px; }
    .report-field { display: flex; flex-direction: column; gap: 2px; }
    .report-field.full { grid-column: 1/-1; }
    .report-field-label { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: #94a3b8; }
    .report-field-value { font-size: 0.92rem; color: #1a202c; font-weight: 500; }
    .report-field-value.empty { color: #cbd5e0; font-style: italic; }
    .report-divider { border: none; border-top: 1.5px solid #e2e8f0; margin: 18px 0; }
    .scope-list { list-style: none; padding: 0; }
    .scope-list li { padding: 5px 0; border-bottom: 1px solid #f0f4f8; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
    .scope-list li::before { content: '‚úì'; color: #38a169 !important; font-weight: 700; font-size: 0.85rem; flex-shrink: 0; }
    .warn-badge { display: inline-flex; align-items: center; gap: 6px; background: #fff8e1 !important; border: 1px solid #f0c040; color: #7d5a00; border-radius: 6px; padding: 4px 10px; font-size: 0.82rem; font-weight: 600; margin-top: 4px; }
    .report-footer { display: none; }
    .acc-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
    .acc-table th { text-align: left; font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: #94a3b8; padding: 5px 8px; border-bottom: 2px solid #e2e8f0; }
    .acc-table td { padding: 7px 8px; border-bottom: 1px solid #f0f4f8; color: #1a202c; vertical-align: middle; }
    .acc-total-row td { font-weight: 700; border-top: 2px solid #e2e8f0; }
    @media print {
      body { margin: 0; }
      .report-wrap { max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="report-wrap">${reportHTML}</div>
  <script>
    window.onload = function() {
      // Give fonts a moment to load then print
      setTimeout(function() { window.print(); }, 600);
    };
  <\/script>
</body>
</html>`);
  win.document.close();
}



const CATALOG = {
  hoops: [
    { id:'h7', name:'54" Glass Backboard Hoop', sku:'542-AA', price:1600, shipping:299, icon:'üèÄ',
      desc:'Premier outdoor basketball goal with compact overhang, built for smaller driveways, backyards, or limited spaces. Tempered glass backboard with true rebound action and rust-resistant aluminum frame. Fully adjustable height for all ages.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2022/10/542-AA-Front-600x600.png' },
    { id:'h8', name:'54" Glass Backboard Hoop - Black', sku:'542-AA-B', price:1650, shipping:299, icon:'üèÄ',
      desc:'Premier outdoor basketball goal with compact overhang, built for smaller driveways, backyards, or limited spaces. Tempered glass backboard with true rebound action and rust-resistant aluminum frame. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2026/02/Black-54-1-180x180.jpg' },
    { id:'h3', name:'60" Glass Backboard Hoop', sku:'603-AA', price:1950, shipping:299, icon:'üèÄ',
      desc:'Premier outdoor basketball hoop with modified tempered glass backboard and smaller overhang. Designed for those with limited playing space who still want unmatched quality.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/02/60xl-Glorify-1-1.png' },
    { id:'h4', name:'60" Glass Backboard Hoop - Black', sku:'603-AA-B', price:2000, shipping:299, icon:'üèÄ',
      desc:'Premier outdoor basketball hoop with modified tempered glass backboard and smaller overhang. Perfect for limited playing space. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2026/02/Black-60-180x180.jpg' },
    { id:'h1', name:'72" Glass Backboard Hoop', sku:'724-AA', price:2000, shipping:299, icon:'üèÄ',
      desc:'Full-sized, easy-to-adjust 72" hoop built with unmatched durability. Gym-level equipment for your driveway or backyard. Smooth height adjustments, stability, and rust-proof materials that hold up season after season.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/02/Untitled-Design-24.png' },
    { id:'h2', name:'72" Glass Backboard Hoop - Black', sku:'724-AA-B', price:2050, shipping:299, icon:'üèÄ',
      desc:'Full-sized, easy-to-adjust 72" hoop. Smooth height adjustments, stability, and rust-proof materials. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2025/09/Black-Hoop-Listing-Tall-180x180.jpg' },
    { id:'h5', name:'72" Aluminum Shatter-Proof Hoop', sku:'724-APA', price:2150, shipping:299, icon:'üèÄ',
      desc:'Full-size gym-level performance with a bulletproof 72" perforated aluminum backboard. Same consistent rebound as glass, built to withstand anything. Rust-proof, easily adjustable, perfect for high-traffic courts.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/11/Untitled-Design-38.png' },
    { id:'h6', name:'72" Aluminum Shatter-Proof Hoop - Black', sku:'724-APA-B', price:2200, shipping:299, icon:'üèÄ',
      desc:'Full-size gym-level performance with a bulletproof 72" perforated aluminum backboard. Built to withstand anything. Premium rust-proof materials. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2026/02/Perf-Woo-black-180x180.jpg' },
    { id:'h9', name:'40" Acrylic Poolside Hoop', sku:'PSH-1', price:800, shipping:299, icon:'üèä',
      desc:'6061 T6 aluminum construction with acrylic backboard and heavy-duty waterproof vinyl-coated rim. All the features of the flagship Dominator Hoop brought to your pool for the best pool basketball experience.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/02/psh-1-2.jpeg' },
  ],
  pickleball_portable: [
    { id:'p4', name:'Pro Max Portable Net - Silver', sku:'pb-max', price:1100, shipping:0, icon:'üè∏',
      desc:'Top-of-the-line portable pickleball net. Maximum stability, premium materials, competition-ready. Silver finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/10/pb-max-white-4-180x180.jpeg' },
    { id:'p4b', name:'Pro Max Portable Net - Black', sku:'pb-max-b', price:1100, shipping:0, icon:'üè∏',
      desc:'Top-of-the-line portable pickleball net. Maximum stability, premium materials, competition-ready. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/10/Black-Pro-Max-4-180x180.png' },
    { id:'p2', name:'Pro Portable Net - Silver', sku:'pb-pro', price:1000, shipping:0, icon:'üè∏',
      desc:'Pro-grade portable net with heavy-duty frame, tournament-spec dimensions, and premium mesh. Silver finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/10/pb-pro-primary-180x180.jpeg' },
    { id:'p2b', name:'Pro Portable Net - Black', sku:'pb-pro-b', price:1000, shipping:0, icon:'üè∏',
      desc:'Pro-grade portable net with heavy-duty frame, tournament-spec dimensions, and premium mesh. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/09/Pro-7-180x180.jpg' },
    { id:'p1', name:'Standard Portable Net', sku:'pb-frame', price:330, shipping:0, icon:'üè∏',
      desc:'Durable portable net system with easy setup. Great entry-level option for recreational play.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/04/0001-11-180x180.png' },
    { id:'ph2l', name:'Hoop-to-Light Pickleball Net', sku:'h2l-net', price:250, shipping:20, icon:'üè∏',
      desc:'Mounts directly between your Dominator hoop pole and light pole ‚Äî no extra posts needed. The ultimate space-saving pickleball net solution for courts that already have a Dominator system.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/01/canvas-1-64e789d751185a56b96b576c-180x180.jpeg' },
  ],
  pickleball_inground: [
    { id:'p6', name:'Square Inground Net', sku:'spb-ig2', price:500, shipping:0, icon:'üè∏',
      desc:'Permanent square post inground net system. Ideal for dedicated pickleball courts.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2022/08/spb-ig2-2-180x180.jpeg' },
    { id:'p9', name:'Square Inground Net - Black', sku:'spb-ig2-b', price:500, shipping:0, icon:'üè∏',
      desc:'Permanent square post inground net system. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2024/06/Untitled-drawing-39-180x180.png' },
    { id:'p7', name:'Round Inground Net', sku:'rpb-ig2', price:500, shipping:0, icon:'üè∏',
      desc:'Permanent round post inground net. Clean look for dedicated courts.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/12/rpb-ig-lifestyle-8-180x180.jpeg' },
    { id:'p10', name:'Round Inground Net - Black', sku:'rpb-ig2-b', price:500, shipping:0, icon:'üè∏',
      desc:'Permanent round post inground net. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/12/rpb-ig2-b-lifestyle-2-180x180.jpeg' },
    { id:'p8', name:'Square Surface Mount Net', sku:'spb-sm2', price:500, shipping:0, icon:'üè∏',
      desc:'Surface-mount net system. Anchors to existing concrete or asphalt ‚Äî no excavation needed.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/08/Surface-Mount-1-180x180.png' },
    { id:'p11', name:'Square Surface Mount Net - Black', sku:'spb-sm2-b', price:500, shipping:0, icon:'üè∏',
      desc:'Surface-mount pickleball net system. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2023/08/Black-Surface-Mount-180x180.png' },
  ],
  lighting: [
    { id:'l1', name:'16ft Pole + 1x 150W LED', sku:'1lp-16-150', price:1000, shipping:300, icon:'üí°',
      desc:'16ft light pole with one 150W LED fixture. Great for smaller courts or supplemental lighting. Brushed aluminum.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/02/Single-16-foot-light-pole-w-150-Fixture-180x180.png' },
    { id:'l4', name:'16ft Pole + 1x 150W LED - Black', sku:'1lp-16-150-b', price:1100, shipping:300, icon:'üí°',
      desc:'16ft light pole with one 150W LED fixture. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/02/Black-Single-4-180x180.png' },
    { id:'l2', name:'16ft Pole + 2x 150W LED', sku:'2lp-16-150', price:1300, shipping:300, icon:'üí°',
      desc:'16ft light pole with two 150W LED fixtures. Ideal for half-court setups. Brushed aluminum.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/02/Double-16-foot-light-pole-w-2-150-w-fixtures-2-180x180.png' },
    { id:'l5', name:'16ft Pole + 2x 150W LED - Black', sku:'2lp-16-150-b', price:1400, shipping:300, icon:'üí°',
      desc:'16ft light pole with two 150W LED fixtures. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/02/Black-Double-3-180x180.png' },
    { id:'l3', name:'16ft Pole + 3x 150W LED', sku:'3lp-16-150', price:1600, shipping:300, icon:'üí°',
      desc:'16ft light pole with three 150W LED fixtures. Full court illumination. Brushed aluminum.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/02/Triple-16-foot-light-pole-w-3-150-w-fixtures-2-180x180.png' },
    { id:'l6', name:'16ft Pole + 3x 150W LED - Black', sku:'3lp-16-150-b', price:1700, shipping:300, icon:'üí°',
      desc:'16ft light pole with three 150W LED fixtures. Premium full-court lighting. Black finish.',
      img:'https://www.dominatorhoop.com/wp-content/uploads/2021/02/Black-Triple-1-180x180.png' },
  ]
};

function getAccSubtotal() {
  let subtotal = 0;
  let hasShipping = false;
  Object.values(data.accessories || {}).forEach(function(acc) {
    if (acc.selected) {
      subtotal += acc.price * acc.qty;
      if (acc.shipping > 0) hasShipping = true;
    }
  });
  var shipping = hasShipping ? 299 : 0;
  var taxRate = data.taxExempt ? 0 : 0.07;
  var tax = (subtotal + shipping) * taxRate;
  return { subtotal: subtotal, shipping: shipping, tax: tax, total: subtotal + shipping + tax };
}

function renderProductCard(p) {
  if (!data.accessories) data.accessories = {};
  var acc = data.accessories[p.id] || { selected: false, qty: 1 };
  var selClass = acc.selected ? ' selected' : '';
  var qtyHtml = '';
  if (acc.selected) {
    qtyHtml = '<div class="qty-row" onclick="event.stopPropagation()">' +
      '<button class="qty-btn" onclick="changeQty(\''+p.id+'\', -1)">&#8722;</button>' +
      '<span class="qty-num" id="qty-'+p.id+'">'+(acc.qty||1)+'</span>' +
      '<button class="qty-btn" onclick="changeQty(\''+p.id+'\', 1)">&#43;</button>' +
      '<span style="font-size:0.72rem;color:var(--gray)">qty</span></div>';
  }
  return '<div class="product-card'+selClass+'" id="pc-'+p.id+'" onclick="toggleAccessory(\''+p.id+'\','+p.price+','+p.shipping+')">' +
    '<div class="pc-check">&#10003;</div>' +
    '<img class="product-img" src="'+p.img+'" alt="'+p.name+'" style="display:block" onload="this.style.opacity=1" onerror="this.parentNode.querySelector(\'.product-img-placeholder\').style.display=\'flex\';this.style.display=\'none\'">' +
    '<div class="product-img-placeholder" style="display:none;width:100%;height:150px;background:linear-gradient(135deg,#e8f1fb,#f4f6f9);align-items:center;justify-content:center;font-size:2.5rem">'+p.icon+'</div>' +
    '<div class="product-info">' +
      '<div class="product-name">'+p.name+'</div>' +
      '<div class="product-desc">'+p.desc+'</div>' +
      '<div class="product-price">$'+p.price.toLocaleString()+'</div>' +
      '<div class="product-ship">'+(p.shipping > 0 ? 'Shipping: $'+p.shipping : 'Free shipping')+'</div>' +
      qtyHtml +
    '</div></div>';
}

function renderPriceBar() {
  var t = getAccSubtotal();
  var taxLabel = data.taxExempt ? 'Tax Exempt' : 'Est. Tax (7%): $'+Math.round(t.tax).toLocaleString();
  return '<div class="price-bar" id="priceBar">' +
    '<div>' +
      '<div class="price-bar-label">Accessories Total</div>' +
      '<div class="price-breakdown">Subtotal $'+t.subtotal.toLocaleString()+' &nbsp;+&nbsp; Shipping $'+t.shipping+' &nbsp;+&nbsp; '+taxLabel+'</div>' +
      '<div class="tax-toggle">' +
        '<label style="display:flex;align-items:center;gap:6px;cursor:pointer">' +
          '<input type="checkbox" id="taxExemptCheck" '+(data.taxExempt?'checked':'')+' onchange="data.taxExempt=this.checked;refreshPriceBar()" style="width:15px;height:15px;accent-color:var(--accent)">' +
          '<span class="tax-toggle-label">Tax Exempt Order</span>' +
        '</label>' +
      '</div>' +
    '</div>' +
    '<div class="price-bar-amount">$'+Math.round(t.total).toLocaleString()+'</div>' +
  '</div>';
}

function refreshPriceBar() {
  var bar = document.getElementById('priceBar');
  if (bar) bar.outerHTML = renderPriceBar();
  // re-attach after replacement
  var newBar = document.getElementById('priceBar');
  // already rendered
}

function toggleAccessory(id, price, shipping) {
  if (!data.accessories) data.accessories = {};
  var existing = data.accessories[id];
  if (existing && existing.selected) {
    data.accessories[id].selected = false;
    var card = document.getElementById('pc-'+id);
    if (card) { card.classList.remove('selected'); card.querySelector('.qty-row') && card.querySelector('.qty-row').remove(); }
  } else {
    data.accessories[id] = { selected: true, qty: 1, price: price, shipping: shipping };
    var card = document.getElementById('pc-'+id);
    if (card) {
      card.classList.add('selected');
      var info = card.querySelector('.product-info');
      if (info && !card.querySelector('.qty-row')) {
        var qtyDiv = document.createElement('div');
        qtyDiv.className = 'qty-row';
        qtyDiv.setAttribute('onclick','event.stopPropagation()');
        qtyDiv.innerHTML = '<button class="qty-btn" onclick="changeQty(\''+id+'\', -1)">&#8722;</button><span class="qty-num" id="qty-'+id+'">1</span><button class="qty-btn" onclick="changeQty(\''+id+'\', 1)">&#43;</button><span style="font-size:0.72rem;color:var(--gray)">qty</span>';
        info.appendChild(qtyDiv);
      }
    }
  }
  refreshPriceBar();
}

function changeQty(id, delta) {
  if (!data.accessories || !data.accessories[id]) return;
  var qty = (data.accessories[id].qty || 1) + delta;
  if (qty < 1) qty = 1;
  data.accessories[id].qty = qty;
  var el = document.getElementById('qty-'+id);
  if (el) el.textContent = qty;
  refreshPriceBar();
}


function lookupTravelTime(address) {
  if (!address) return;
  // Step 1: Geocode the destination address via Nominatim
  var geocodeUrl = 'https://nominatim.openstreetmap.org/search?format=json&limit=1&q=' + encodeURIComponent(address);
  fetch(geocodeUrl, { headers: { 'Accept': 'application/json' } })
    .then(function(r) { return r.json(); })
    .then(function(results) {
      if (!results || !results.length) { data.travelHours = 1; return; }
      var destLat = parseFloat(results[0].lat);
      var destLon = parseFloat(results[0].lon);
      // CubeSmart East Hanover NJ: 340 Littell Rd
      var origLat = 40.8202, origLon = -74.3607;
      // Step 2: Use OSRM for real road routing (free, no API key)
      var osrmUrl = 'https://router.project-osrm.org/route/v1/driving/'
        + origLon + ',' + origLat + ';'
        + destLon + ',' + destLat
        + '?overview=false';
      return fetch(osrmUrl)
        .then(function(r) { return r.json(); })
        .then(function(route) {
          var durationSec, distMeters;
          if (route && route.routes && route.routes.length) {
            durationSec  = route.routes[0].duration; // seconds
            distMeters   = route.routes[0].distance; // meters
            var hrs  = durationSec / 3600;
            // Round to nearest 0.25hr, minimum 0.25
            hrs = Math.max(0.25, Math.round(hrs * 4) / 4);
            var miles = (distMeters / 1609.34).toFixed(1);
            data.travelHours = hrs;
            data.travelMiles = parseFloat(miles);
            console.log('OSRM route: ' + miles + ' mi, ' + (durationSec/60).toFixed(0) + ' min -> ' + hrs + ' hrs');
          } else {
            // OSRM failed ‚Äî fall back to haversine with 1.4x road factor at 28mph avg
            var R = 3958.8;
            var dLat = (destLat-origLat)*Math.PI/180;
            var dLon = (destLon-origLon)*Math.PI/180;
            var a = Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(origLat*Math.PI/180)*Math.cos(destLat*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);
            var straightMiles = R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
            var roadMiles = straightMiles * 1.4; // road distance typically 40% longer than straight line
            var hrs = Math.max(0.25, Math.round((roadMiles / 28) * 4) / 4);
            data.travelHours = hrs;
            data.travelMiles = Math.round(roadMiles);
            console.log('Fallback haversine: ' + roadMiles.toFixed(1) + ' road mi -> ' + hrs + ' hrs');
          }
        });
    })
    .catch(function(e) {
      console.log('Travel lookup failed:', e);
      data.travelHours = 1;
    });
}

function setPaintType(type) {
  data.paintType = type;
  renderStep();
}

// ‚îÄ‚îÄ‚îÄ DEFAULT MATERIAL LIST (from Tennis_Paint_New_Asphalt.xlsx) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var DEFAULT_PAINT_MATERIALS = [
  { name: 'Acrylic Resurfacer',  cost: 780,  qty: 3,  freight: 800, scale: true  },
  { name: 'Coarse Sealer Sand',  cost: 9,    qty: 39, freight: 0,   scale: true  },
  { name: 'Neutral Concentrate', cost: 711,  qty: 2,  freight: 0,   scale: true  },
  { name: 'Color Plus Tint',     cost: 81,   qty: 8,  freight: 0,   scale: true  },
  { name: 'Fine Sand',           cost: 14,   qty: 16, freight: 0,   scale: true  },
  { name: 'Patch Binder',        cost: 143,  qty: 1,  freight: 0,   scale: false },
  { name: 'TC Line Paint',       cost: 37,   qty: 1,  freight: 0,   scale: false },
  { name: 'Line Primer',         cost: 23,   qty: 1,  freight: 0,   scale: false },
  { name: 'Squeegee',            cost: 50,   qty: 1,  freight: 0,   scale: false },
  { name: 'Tar Paper',           cost: 37,   qty: 1,  freight: 0,   scale: false },
  { name: 'Masking Tape',        cost: 25,   qty: 3,  freight: 0,   scale: false },
  { name: 'Utility Blades',      cost: 2,    qty: 2,  freight: 0,   scale: false },
  { name: 'String Line',         cost: 11,   qty: 1,  freight: 0,   scale: false },
  { name: 'Buckets',             cost: 4,    qty: 3,  freight: 0,   scale: false },
  { name: 'Bucket Lids',         cost: 3,    qty: 2,  freight: 0,   scale: false },
  { name: 'Roller Refills',      cost: 5,    qty: 1,  freight: 0,   scale: false },
  { name: 'Rosin Paper',         cost: 14,   qty: 1,  freight: 0,   scale: false },
  { name: 'Rub Bricks',          cost: 17,   qty: 4,  freight: 0,   scale: false },
  { name: 'Sanding Disc',        cost: 10.5, qty: 1,  freight: 0,   scale: false },
  { name: 'Portland Cement',     cost: 20,   qty: 1,  freight: 0,   scale: false },
  { name: 'Power Washer Rental', cost: 150,  qty: 1,  freight: 0,   scale: false },
  { name: 'Trash Removal',       cost: 300,  qty: 1,  freight: 0,   scale: false },
  { name: 'Gasoline',            cost: 3.5,  qty: 5,  freight: 0,   scale: false },
];

function getPaintMaterials() {
  return data.paintMaterials || DEFAULT_PAINT_MATERIALS.map(function(m){ return Object.assign({}, m); });
}

function calcPaint(L, W, lr, otr, mk, trav) {
  var sqFt = L * W;
  var sqYd = sqFt / 9;
  var scale = sqYd / 800;
  var mats = getPaintMaterials();
  var matTotal = 0;
  mats.forEach(function(m) {
    var q = m.scale ? Math.ceil(m.qty * scale) : m.qty;
    matTotal += (m.cost * q) + (m.freight || 0);
  });
  // Labor ‚Äî 5 days, 2 staff (from spreadsheet)
  var days = [5, 5, 6, 5, 5];
  var staff = 2;
  var travelPrep = (trav * 2) + 1;
  var totalLaborHrs = 0, totalTravHrs = 0, totalOT = 0;
  days.forEach(function(h) {
    totalLaborHrs += staff * h;
    totalTravHrs  += travelPrep * staff;
    totalOT       += Math.max(0, travelPrep + h - 8) * staff;
  });
  var regHrs = totalLaborHrs - totalOT + totalTravHrs;
  var laborCost = (regHrs * lr) + (totalOT * otr);
  var subtotal = matTotal + laborCost;
  var markup = subtotal * (mk / 100);
  var total = subtotal + markup;
  return {
    sqFt: sqFt, sqYd: Math.round(sqYd), scale: scale,
    matTotal: Math.round(matTotal),
    regHrs: Math.round(regHrs * 10) / 10,
    otHrs: Math.round(totalOT * 10) / 10,
    travHrs: Math.round(totalTravHrs * 10) / 10,
    laborCost: Math.round(laborCost),
    subtotal: Math.round(subtotal),
    markup: Math.round(markup),
    total: Math.round(total),
    lr: lr, otr: otr, mk: mk, trav: trav
  };
}

// Material editor helpers
var _newMatScale = false;

function toggleMaterialEditor() {
  var wrap = document.getElementById('matEditorWrap');
  if (!wrap) return;
  var isHidden = wrap.style.display === 'none' || wrap.style.display === '';
  wrap.style.display = isHidden ? 'block' : 'none';
  var btn = document.getElementById('matModBtn');
  if (btn) btn.textContent = isHidden ? '‚ñ≤ Hide Material Breakdown' : '‚úè Modify Materials';
  if (isHidden) renderMatEditor();
}

function renderMatEditor() {
  var wrap = document.getElementById('matEditorWrap');
  if (!wrap) return;
  var mats = getPaintMaterials();
  var L = parseFloat((document.getElementById('pe-L')||{}).value) || 60;
  var W = parseFloat((document.getElementById('pe-W')||{}).value) || 120;
  var scale = (L * W / 9) / 800;

  var html = '<div class="mat-editor">';
  // Header row
  html += '<div class="mat-row mat-header">'
       + '<span class="mc mc-name">Material</span>'
       + '<span class="mc mc-num">Unit ($)</span>'
       + '<span class="mc mc-num">Base Qty</span>'
       + '<span class="mc mc-num">Freight ($)</span>'
       + '<span class="mc mc-scale">Scales?</span>'
       + '<span class="mc mc-total">Line Total</span>'
       + '<span class="mc mc-del"></span>'
       + '</div>';

  mats.forEach(function(m, i) {
    var effQty = m.scale ? Math.ceil(m.qty * scale) : m.qty;
    var lineTotal = (m.cost * effQty) + (m.freight || 0);
    html += '<div class="mat-row" id="matrow-' + i + '">'
          + '<input class="mc mc-name mat-input" value="' + m.name.replace(/"/g,'&quot;') + '" oninput="updateMat(' + i + ',\'name\',this.value)">'
          + '<input class="mc mc-num mat-input" type="number" min="0" step="0.01" value="' + m.cost + '" oninput="updateMat(' + i + ',\'cost\',+this.value)">'
          + '<input class="mc mc-num mat-input" type="number" min="0" step="1" value="' + m.qty + '" oninput="updateMat(' + i + ',\'qty\',+this.value)">'
          + '<input class="mc mc-num mat-input" type="number" min="0" step="0.01" value="' + (m.freight||0) + '" oninput="updateMat(' + i + ',\'freight\',+this.value)">'
          + '<div class="mc mc-scale"><button class="mat-scale-btn' + (m.scale ? ' active' : '') + '" onclick="updateMat(' + i + ',\'scale\',' + (!m.scale) + ');renderMatEditor()">' + (m.scale ? '‚öñ Yes' : '‚Äî No') + '</button></div>'
          + '<span class="mc mc-total mat-line-total" id="matline-' + i + '">$' + Math.round(lineTotal).toLocaleString() + '</span>'
          + '<button class="mc mc-del mat-del-btn" onclick="deleteMat(' + i + ')" title="Remove">‚úï</button>'
          + '</div>';
  });

  // Add new row
  html += '<div class="mat-row mat-add-row">'
        + '<input class="mc mc-name mat-input" id="newMatName" placeholder="New item name">'
        + '<input class="mc mc-num mat-input" id="newMatCost" type="number" min="0" step="0.01" placeholder="0.00">'
        + '<input class="mc mc-num mat-input" id="newMatQty" type="number" min="0" step="1" placeholder="1">'
        + '<input class="mc mc-num mat-input" id="newMatFreight" type="number" min="0" step="0.01" placeholder="0">'
        + '<div class="mc mc-scale"><button class="mat-scale-btn" id="newMatScaleBtn" onclick="toggleNewMatScale()">‚Äî No</button></div>'
        + '<span class="mc mc-total"></span>'
        + '<button class="mat-add-btn mc mc-del" onclick="addNewMat()">+ Add</button>'
        + '</div>';

  html += '<div class="mat-editor-footer">'
        + '<button class="mat-reset-btn" onclick="resetMaterials()">‚Ü∫ Reset to Defaults</button>'
        + '<span class="mat-footer-note">‚öñ Scaled items multiply base qty by (court sq yds √∑ 800). Non-scaled items use base qty as-is.</span>'
        + '</div></div>';

  wrap.innerHTML = html;
  _newMatScale = false;
}

function toggleNewMatScale() {
  _newMatScale = !_newMatScale;
  var btn = document.getElementById('newMatScaleBtn');
  if (btn) { btn.textContent = _newMatScale ? '‚öñ Yes' : '‚Äî No'; btn.classList.toggle('active', _newMatScale); }
}

function updateMat(i, field, val) {
  if (!data.paintMaterials) data.paintMaterials = getPaintMaterials();
  data.paintMaterials[i][field] = val;
  // Refresh line total in place without full re-render
  if (field !== 'name') {
    var m = data.paintMaterials[i];
    var L = parseFloat((document.getElementById('pe-L')||{}).value) || 60;
    var W = parseFloat((document.getElementById('pe-W')||{}).value) || 120;
    var scale = (L * W / 9) / 800;
    var effQty = m.scale ? Math.ceil(m.qty * scale) : m.qty;
    var lineTotal = (m.cost * effQty) + (m.freight || 0);
    var el = document.getElementById('matline-' + i);
    if (el) el.textContent = '$' + Math.round(lineTotal).toLocaleString();
    if (field === 'scale') {
      var btn = document.querySelector('#matrow-' + i + ' .mat-scale-btn');
      if (btn) { btn.textContent = val ? '‚öñ Yes' : '‚Äî No'; btn.classList.toggle('active', val); }
    }
    refreshPaintEst();
  }
}

function deleteMat(i) {
  if (!data.paintMaterials) data.paintMaterials = getPaintMaterials();
  data.paintMaterials.splice(i, 1);
  renderMatEditor();
  refreshPaintEst();
}

function addNewMat() {
  var name    = ((document.getElementById('newMatName')||{}).value||'').trim();
  var cost    = parseFloat((document.getElementById('newMatCost')||{}).value)||0;
  var qty     = parseFloat((document.getElementById('newMatQty')||{}).value)||1;
  var freight = parseFloat((document.getElementById('newMatFreight')||{}).value)||0;
  if (!name) { alert('Please enter a material name.'); return; }
  if (!data.paintMaterials) data.paintMaterials = getPaintMaterials();
  data.paintMaterials.push({ name: name, cost: cost, qty: qty, freight: freight, scale: _newMatScale });
  renderMatEditor();
  refreshPaintEst();
}

function resetMaterials() {
  if (!confirm('Reset all materials to spreadsheet defaults? This will discard any changes.')) return;
  data.paintMaterials = null;
  renderMatEditor();
  refreshPaintEst();
}


function buildPaintEst(L, W, lr, otr, mk, trav) {
  var e = calcPaint(L, W, lr, otr, mk, trav);
  data.paintEst = e;
  var html = '<div class="estimate-box">';
  html += '<div class="estimate-box-title">Paint Estimate &mdash; ' + L + ' &times; ' + W + ' ft (' + e.sqFt.toLocaleString() + ' sq ft / ' + e.sqYd.toLocaleString() + ' sq yds)</div>';
  html += '<div class="estimate-row"><span class="estimate-row-label">Materials</span><span class="estimate-row-value">$' + e.matTotal.toLocaleString() + '</span></div>';
  html += '<div class="estimate-row"><span class="estimate-row-label">Regular Labor (' + e.regHrs + ' hrs @ $' + lr + '/hr)</span><span class="estimate-row-value">$' + Math.round(e.regHrs * lr).toLocaleString() + '</span></div>';
  if (e.otHrs > 0) {
    html += '<div class="estimate-row"><span class="estimate-row-label">Overtime (' + e.otHrs + ' hrs @ $' + otr + '/hr)</span><span class="estimate-row-value">$' + Math.round(e.otHrs * otr).toLocaleString() + '</span></div>';
  }
  html += '<div class="estimate-row"><span class="estimate-row-label">Travel (' + e.trav + ' hr one way &rarr; ' + e.travHrs + ' total hrs)</span><span class="estimate-row-value">included in labor</span></div>';
  html += '<div class="estimate-row"><span class="estimate-row-label">Subtotal</span><span class="estimate-row-value">$' + e.subtotal.toLocaleString() + '</span></div>';
  html += '<div class="estimate-row"><span class="estimate-row-label">Markup (' + mk + '%)</span><span class="estimate-row-value">$' + e.markup.toLocaleString() + '</span></div>';
  html += '<div class="estimate-total"><span class="estimate-total-label">Total Estimate</span><span class="estimate-total-value">$' + e.total.toLocaleString() + '</span></div>';
  html += '<div style="margin-top:12px;text-align:right"><button class="btn-modify-mat" id="matModBtn" onclick="toggleMaterialEditor()">&#9998; Modify Materials</button></div>';
  html += '</div>';
  html += '<div id="matEditorWrap" style="display:none"></div>';
  return html;
}


function refreshPaintEst() {
  var L = parseFloat(document.getElementById('pe-L').value) || 60;
  var W = parseFloat(document.getElementById('pe-W').value) || 120;
  var lr = parseFloat(document.getElementById('pe-lr').value) || 30;
  var otr = parseFloat(document.getElementById('pe-ot').value) || 45;
  var mk = parseFloat(document.getElementById('pe-mk').value) || 30;
  var tr = parseFloat(document.getElementById('pe-trav').value) || 1;
  var el = document.getElementById('paintEstBox');
  if (el) el.innerHTML = buildPaintEst(L, W, lr, otr, mk, tr);
}

function restart() {
  // Clear data
  Object.keys(data).forEach(k => delete data[k]);
  currentStep = 0;
  document.getElementById('reportContainer').classList.add('hidden');
  document.getElementById('reportContainer').innerHTML = '';
  document.getElementById('stepsContainer').classList.remove('hidden');
  document.getElementById('progressWrap').classList.remove('hidden');
  renderStep();
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
renderStep();
</script>


```
</body></html>